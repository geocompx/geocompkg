<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Geocomputation with R - Exercises and Solutions • geocompkg</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Geocomputation with R - Exercises and Solutions">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocompkg</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.66</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/join.html">Spatial Joins Extended</a>
    </li>
    <li>
      <a href="../articles/solutions.html">Geocomputation with R - Exercises and Solutions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Robinlovelace/geocompr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Geocomputation with R - Exercises and Solutions</h1>
                        <h4 class="author">Robin Lovelace, Jakub Nowosad, Jannes Muenchow</h4>
            
            <h4 class="date">2018-08-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Robinlovelace/geocompr/blob/master/vignettes/solutions.Rmd"><code>vignettes/solutions.Rmd</code></a></small>
      <div class="hidden name"><code>solutions.Rmd</code></div>

    </div>

    
    
<div id="prerequisites" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>The solutions assume the following packages are attached (other packages will be attached when needed):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(spData)</code></pre></div>
</div>
<div id="chapter-1" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-1" class="anchor"></a>Chapter 1</h1>
<ol style="list-style-type: decimal">
<li><p>Think about the terms ‘GIS’, ‘GDS’ and ‘Geocomputation’ described above. Which is your favorite and and why?</p></li>
<li><p>Provide 3 reasons for using a scriptable language such R for geocomputation instead of established GIS programs such as QGIS.</p></li>
</ol>
<ul>
<li>Reproducibility: a sequence of operations is much easier to save and share when using a scripting language.</li>
<li>Scalability: scripting languages make it easy to break-up the work and parallelise, making it more scalable.</li>
<li>Flexibility: the building blocks of the language allows it to interface efficiently with external software, enabling R to perform a wide range of tasks (e.g. animations, online interactive maps).</li>
<li>Efficiency: the GUI of GIS programs can be slow to use and install.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Name two advantages and two disadvantages of using the older <strong>sp</strong> package compared with the new <strong>sf</strong> package.</li>
</ol>
<ul>
<li>
<code>+</code> Number of packages supported.</li>
<li>
<code>+</code> Stability</li>
<li>
<code>-</code> Slow performance</li>
<li>
<code>-</code> Non standard data format</li>
</ul>
</div>
<div id="chapter-2" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-2" class="anchor"></a>Chapter 2</h1>
<!-- vector exercises -->
<ol style="list-style-type: decimal">
<li>What does the summary of the <code>geometry</code> column tell us about the <code>world</code> dataset, in terms of:
<ul>
<li>The geometry type?</li>
<li>How many countries there are?</li>
<li>The coordinate reference system (CRS)?</li>
</ul>
</li>
<li>Using <strong>sf</strong>’s <code><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot()</a></code> command, create a map of Nigeria in context, building on the code that creates and plots Asia above (see Figure @ref(fig:asia) for an example of what this could look like).
<ul>
<li>Hint: this used the <code>lwd</code>, <code>main</code> and <code>col</code> arguments of <code><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot()</a></code>.</li>
<li>Bonus: make the country boundaries a dotted grey line.</li>
<li>Hint: <code>border</code> is an additional argument of <code><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot()</a></code> for <strong>sf</strong> objects.</li>
</ul>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nigeria =<span class="st"> </span>world[world<span class="op">$</span>name_long <span class="op">==</span><span class="st"> "Nigeria"</span>, ]
africa =<span class="st"> </span>world[world<span class="op">$</span>continent <span class="op">==</span><span class="st"> "Africa"</span>, ]
bb_africa =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_bbox">st_bbox</a></span>(africa)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(africa[<span class="dv">2</span>], <span class="dt">col =</span> <span class="st">"white"</span>, <span class="dt">lwd =</span> <span class="dv">3</span>, <span class="dt">main =</span> <span class="st">"Nigeria in context"</span>, <span class="dt">border =</span> <span class="st">"lightgrey"</span>)
<span class="co"># plot(world, lty = 3, add = TRUE, border = "grey")</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(world, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">border =</span> <span class="st">"grey"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(nigeria, <span class="dt">col =</span> <span class="st">"yellow"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">border =</span> <span class="st">"darkgrey"</span>)
ncentre =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/geos_unary">st_centroid</a></span>(nigeria)
ncentre_num =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_coordinates">st_coordinates</a></span>(ncentre)
<span class="kw">text</span>(<span class="dt">x =</span> ncentre_num[<span class="dv">1</span>], <span class="dt">y =</span> ncentre_num[<span class="dv">2</span>], <span class="dt">labels =</span> <span class="st">"Nigeria"</span>)</code></pre></div>
<div class="figure">
<img src="solutions_files/figure-html/nigeria-1.png" alt="Map of Nigeria in context illustrating sf's plotting capabilities" width="700"><p class="caption">
Map of Nigeria in context illustrating sf’s plotting capabilities
</p>
</div>
<ol start="3" style="list-style-type: decimal">
<li>What does the <code>cex</code> argument do in the <code><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot()</a></code> function that generates Figure @ref(fig:contpop)?
<ul>
<li>Why was <code>cex</code> passed the <code>sqrt(world$pop) / 10000</code> instead of just the population directly?</li>
<li>Bonus: what equivalent arguments to <code>cex</code> exist in the dedicated vizualisation package <strong>tmap</strong>?</li>
</ul>
</li>
<li>Re-run the code that ‘generated’ Figure @ref(fig:contpop) at the end of @ref(base-args) and find 3 similarities and 3 differences between the plot produced on your computer and that in the book.
<ul>
<li>What is similar?
<ul>
<li>The map orientation (north is up), colors of the continents and sizes of the circles are the same, among other things.</li>
</ul>
</li>
<li>What has changed?
<ul>
<li>The shape of the countries (an equal area projection has been used), the color of the points has changed (to red) and are now filled in (using the <code>pch</code> argument to change the point symbol), the plot has graticules and (most subtly) the points are now in the centroid of the largest polygon of each country, rather than in the area-weighted centroid across all polygons per country.</li>
</ul>
</li>
<li>Bonus: play around with and research base plotting arguments to make your version of Figure @ref(fig:contpop) more attractive. Which arguments were most useful.
<ul>
<li>This is a subjective question: have fun!</li>
</ul>
</li>
<li>Advanced: try to reproduce the map presented in Figure @ref(base-args). Copy-and-pasting is prohibited!
<ul>
<li>You can <em>look</em> at the code that generated the plot here: <a href="https://github.com/Robinlovelace/geocompr/blob/master/02-spatial-data.Rmd" class="uri">https://github.com/Robinlovelace/geocompr/blob/master/02-spatial-data.Rmd</a> . If you memorise its important parts, and type them in your own script to reproduce the code that does not count as cheating. That will be a valuable learning experience.</li>
</ul>
</li>
</ul>
</li>
</ol>
<!-- raster exercises --><ol start="5" style="list-style-type: decimal">
<li>Read the <code>raster/nlcd2011.tif</code> file from the <strong>spDataLarge</strong> package. What kind of information can you get about the properties of this file? <!-- (crs, ncols, nrow, ncells, bbox, navalues) -->
</li>
<li><p>Create an empty <code>RasterLayer</code> object called <code>my_raster</code> with 10 columns and 10 rows, and resolution of 10 units. Assign random values between 0 and 10 to the new raster and plot it. <!-- crs exercises --> <!-- 1. pros and cons of the projection types --> <!-- 1. what's the difference between vector and raster transformation --> <!-- units exercises --> <!-- 1. ?? --></p></li>
<li><p>Exercise 3 <!--missing title--></p></li>
</ol>
<ul>
<li>What does the <code>lwd</code> argument do in the <code><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot()</a></code> code that generates Figure @ref(fig:africa).</li>
<li>Perform the same operations and map making for another continent of your choice.</li>
<li>Bonus: Download some global geographic data and add attribute variables assigning them to the continents of the world.</li>
</ul>
</div>
<div id="chapter-3" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-3" class="anchor"></a>Chapter 3</h1>
<!-- Attribute subsetting -->
<ol style="list-style-type: decimal">
<li>Select only the <code>NAME</code> column in <code>us_states</code> and create a new object called <code>us_states_name</code>. What is the class of the new object? <!--why there is a "sf" part? -->
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_name =<span class="st"> </span>us_states <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(NAME)
<span class="kw">class</span>(us_states_name)
<span class="co">#&gt; [1] "sf"         "data.frame"</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Select columns which contain information about a total population. Think about as many ways as possible to do it. Hint: try to use helper functions, such as <code>contains</code> or <code>starts_with</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(total_pop_<span class="dv">10</span>, total_pop_<span class="dv">15</span>)
<span class="co">#&gt; Simple feature collection with 49 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    total_pop_10 total_pop_15                       geometry</span>
<span class="co">#&gt; 1       4712651      4830620 MULTIPOLYGON (((-88.20006 3...</span>
<span class="co">#&gt; 2       6246816      6641928 MULTIPOLYGON (((-114.7196 3...</span>
<span class="co">#&gt; 3       4887061      5278906 MULTIPOLYGON (((-109.0501 4...</span>
<span class="co">#&gt; 4       3545837      3593222 MULTIPOLYGON (((-73.48731 4...</span>
<span class="co">#&gt; 5      18511620     19645772 MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 6       9468815     10006693 MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 7       1526797      1616547 MULTIPOLYGON (((-116.916 45...</span>
<span class="co">#&gt; 8       6417398      6568645 MULTIPOLYGON (((-87.52404 4...</span>
<span class="co">#&gt; 9       2809329      2892987 MULTIPOLYGON (((-102.0517 4...</span>
<span class="co">#&gt; 10      4429940      4625253 MULTIPOLYGON (((-92.01783 2...</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">"total_pop"</span>))
<span class="co">#&gt; Simple feature collection with 49 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    total_pop_10 total_pop_15                       geometry</span>
<span class="co">#&gt; 1       4712651      4830620 MULTIPOLYGON (((-88.20006 3...</span>
<span class="co">#&gt; 2       6246816      6641928 MULTIPOLYGON (((-114.7196 3...</span>
<span class="co">#&gt; 3       4887061      5278906 MULTIPOLYGON (((-109.0501 4...</span>
<span class="co">#&gt; 4       3545837      3593222 MULTIPOLYGON (((-73.48731 4...</span>
<span class="co">#&gt; 5      18511620     19645772 MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 6       9468815     10006693 MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 7       1526797      1616547 MULTIPOLYGON (((-116.916 45...</span>
<span class="co">#&gt; 8       6417398      6568645 MULTIPOLYGON (((-87.52404 4...</span>
<span class="co">#&gt; 9       2809329      2892987 MULTIPOLYGON (((-102.0517 4...</span>
<span class="co">#&gt; 10      4429940      4625253 MULTIPOLYGON (((-92.01783 2...</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">"total_pop"</span>))
<span class="co">#&gt; Simple feature collection with 49 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    total_pop_10 total_pop_15                       geometry</span>
<span class="co">#&gt; 1       4712651      4830620 MULTIPOLYGON (((-88.20006 3...</span>
<span class="co">#&gt; 2       6246816      6641928 MULTIPOLYGON (((-114.7196 3...</span>
<span class="co">#&gt; 3       4887061      5278906 MULTIPOLYGON (((-109.0501 4...</span>
<span class="co">#&gt; 4       3545837      3593222 MULTIPOLYGON (((-73.48731 4...</span>
<span class="co">#&gt; 5      18511620     19645772 MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 6       9468815     10006693 MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 7       1526797      1616547 MULTIPOLYGON (((-116.916 45...</span>
<span class="co">#&gt; 8       6417398      6568645 MULTIPOLYGON (((-87.52404 4...</span>
<span class="co">#&gt; 9       2809329      2892987 MULTIPOLYGON (((-102.0517 4...</span>
<span class="co">#&gt; 10      4429940      4625253 MULTIPOLYGON (((-92.01783 2...</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Find all states that:</li>
</ol>
<ul>
<li>Belongs to the Midwest region</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(total_pop_<span class="dv">15</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">750000</span>)
<span class="co">#&gt; Simple feature collection with 4 features and 6 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -111.0552 ymin: 38.79165 xmax: -71.49392 ymax: 49.00069</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt;   GEOID                 NAME   REGION           AREA total_pop_10</span>
<span class="co">#&gt; 1    38         North Dakota  Midwest 183177.83 km^2       659858</span>
<span class="co">#&gt; 2    50              Vermont Norteast  24866.16 km^2       624258</span>
<span class="co">#&gt; 3    11 District of Columbia    South    178.21 km^2       584400</span>
<span class="co">#&gt; 4    56              Wyoming     West 253309.56 km^2       545579</span>
<span class="co">#&gt;   total_pop_15                       geometry</span>
<span class="co">#&gt; 1       721640 MULTIPOLYGON (((-104.0487 4...</span>
<span class="co">#&gt; 2       626604 MULTIPOLYGON (((-73.34312 4...</span>
<span class="co">#&gt; 3       647484 MULTIPOLYGON (((-77.11976 3...</span>
<span class="co">#&gt; 4       579679 MULTIPOLYGON (((-104.0577 4...</span></code></pre></div>
<ul>
<li>Had a total population in 2015 lower than 750,000 residents</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(total_pop_<span class="dv">15</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">750000</span>)
<span class="co">#&gt; Simple feature collection with 4 features and 6 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -111.0552 ymin: 38.79165 xmax: -71.49392 ymax: 49.00069</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt;   GEOID                 NAME   REGION           AREA total_pop_10</span>
<span class="co">#&gt; 1    38         North Dakota  Midwest 183177.83 km^2       659858</span>
<span class="co">#&gt; 2    50              Vermont Norteast  24866.16 km^2       624258</span>
<span class="co">#&gt; 3    11 District of Columbia    South    178.21 km^2       584400</span>
<span class="co">#&gt; 4    56              Wyoming     West 253309.56 km^2       545579</span>
<span class="co">#&gt;   total_pop_15                       geometry</span>
<span class="co">#&gt; 1       721640 MULTIPOLYGON (((-104.0487 4...</span>
<span class="co">#&gt; 2       626604 MULTIPOLYGON (((-73.34312 4...</span>
<span class="co">#&gt; 3       647484 MULTIPOLYGON (((-77.11976 3...</span>
<span class="co">#&gt; 4       579679 MULTIPOLYGON (((-104.0577 4...</span></code></pre></div>
<ul>
<li>Belongs to the West region, had an area smaller than 250,000 km<sup>2</sup> and total population in 2015 larger than 5,000,000 residents</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "West"</span>, AREA <span class="op">&lt;</span><span class="st"> </span>units<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">250000</span>, km<span class="op">^</span><span class="dv">2</span>),total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">5000000</span>)
<span class="co">#&gt; Simple feature collection with 1 feature and 6 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 45.54774 xmax: -116.916 ymax: 49.00236</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt;   GEOID       NAME REGION        AREA total_pop_10 total_pop_15</span>
<span class="co">#&gt; 1    53 Washington   West 175436 km^2      6561297      6985464</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 MULTIPOLYGON (((-122.7699 4...</span>
<span class="co"># or</span>
us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "West"</span>, <span class="kw">as.numeric</span>(AREA) <span class="op">&lt;</span><span class="st"> </span><span class="dv">250000</span>,total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">5000000</span>)
<span class="co">#&gt; Simple feature collection with 1 feature and 6 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 45.54774 xmax: -116.916 ymax: 49.00236</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt;   GEOID       NAME REGION        AREA total_pop_10 total_pop_15</span>
<span class="co">#&gt; 1    53 Washington   West 175436 km^2      6561297      6985464</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 MULTIPOLYGON (((-122.7699 4...</span></code></pre></div>
<ul>
<li>Belongs to the South region, had an area larger than 150,000 km<sup>2</sup> or total population in 2015 larger than 7,000,000 residents</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "South"</span>, AREA <span class="op">&gt;</span><span class="st"> </span>units<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/units/topics/set_units">set_units</a></span>(<span class="dv">150000</span>, km<span class="op">^</span><span class="dv">2</span>), total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">7000000</span>)
<span class="co">#&gt; Simple feature collection with 3 features and 6 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -106.6359 ymin: 24.55868 xmax: -80.03136 ymax: 36.50044</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt;   GEOID    NAME REGION          AREA total_pop_10 total_pop_15</span>
<span class="co">#&gt; 1    12 Florida  South 151052.0 km^2     18511620     19645772</span>
<span class="co">#&gt; 2    13 Georgia  South 152725.2 km^2      9468815     10006693</span>
<span class="co">#&gt; 3    48   Texas  South 687714.3 km^2     24311891     26538614</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 2 MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 3 MULTIPOLYGON (((-103.0024 3...</span>
<span class="co"># or</span>
us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(REGION <span class="op">==</span><span class="st"> "South"</span>, <span class="kw">as.numeric</span>(AREA) <span class="op">&gt;</span><span class="st"> </span><span class="dv">150000</span>, total_pop_<span class="dv">15</span> <span class="op">&gt;</span><span class="st"> </span><span class="dv">7000000</span>)
<span class="co">#&gt; Simple feature collection with 3 features and 6 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -106.6359 ymin: 24.55868 xmax: -80.03136 ymax: 36.50044</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt;   GEOID    NAME REGION          AREA total_pop_10 total_pop_15</span>
<span class="co">#&gt; 1    12 Florida  South 151052.0 km^2     18511620     19645772</span>
<span class="co">#&gt; 2    13 Georgia  South 152725.2 km^2      9468815     10006693</span>
<span class="co">#&gt; 3    48   Texas  South 687714.3 km^2     24311891     26538614</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 2 MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 3 MULTIPOLYGON (((-103.0024 3...</span></code></pre></div>
<!-- 4. Exercises about additional select and filter helper functions (one_of; between, is.na, near, etc.) -->
<!-- Attribute aggregation -->
<ol start="4" style="list-style-type: decimal">
<li>What was the total population in 2015 in the <code>us_states</code> database? What was the minimum and maximum total population in 2015?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarize</span>(<span class="dt">total_pop =</span> <span class="kw">sum</span>(total_pop_<span class="dv">15</span>),
                        <span class="dt">min_pop =</span> <span class="kw">min</span>(total_pop_<span class="dv">15</span>),
                        <span class="dt">max_pop =</span> <span class="kw">max</span>(total_pop_<span class="dv">15</span>))
<span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt;   total_pop min_pop  max_pop                       geometry</span>
<span class="co">#&gt; 1 314375347  579679 38421464 MULTIPOLYGON (((-81.81169 2...</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>How many states are in each region?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">nr_of_states =</span> <span class="kw">n</span>())
<span class="co">#&gt; Simple feature collection with 4 features and 2 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   REGION   nr_of_states                                           geometry</span>
<span class="co">#&gt;   &lt;fct&gt;           &lt;int&gt;                                 &lt;MULTIPOLYGON [°]&gt;</span>
<span class="co">#&gt; 1 Norteast            9 (((-68.9446 44.11284, -68.82507 44.18634, -68.770…</span>
<span class="co">#&gt; 2 Midwest            12 (((-89.2552 47.8761, -89.17915 47.93503, -88.8357…</span>
<span class="co">#&gt; 3 South              17 (((-81.81169 24.56874, -81.74565 24.65988, -81.44…</span>
<span class="co">#&gt; 4 West               11 (((-118.6055 33.031, -118.37 32.83927, -118.4963 …</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>What was the minimum and maximum total population in 2015 in each region? What was the total population in 2015 in each region?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min_pop =</span> <span class="kw">min</span>(total_pop_<span class="dv">15</span>),
            <span class="dt">max_pop =</span> <span class="kw">max</span>(total_pop_<span class="dv">15</span>),
            <span class="dt">tot_pop =</span> <span class="kw">sum</span>(total_pop_<span class="dv">15</span>))
<span class="co">#&gt; Simple feature collection with 4 features and 4 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; # A tibble: 4 x 5</span>
<span class="co">#&gt;   REGION  min_pop  max_pop tot_pop                                geometry</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;                      &lt;MULTIPOLYGON [°]&gt;</span>
<span class="co">#&gt; 1 Nortea…  626604 19673174  5.60e7 (((-68.9446 44.11284, -68.82507 44.186…</span>
<span class="co">#&gt; 2 Midwest  721640 12873761  6.75e7 (((-89.2552 47.8761, -89.17915 47.9350…</span>
<span class="co">#&gt; 3 South    647484 26538614  1.19e8 (((-81.81169 24.56874, -81.74565 24.65…</span>
<span class="co">#&gt; 4 West     579679 38421464  7.23e7 (((-118.6055 33.031, -118.37 32.83927,…</span></code></pre></div>
<!-- Attribute joining -->
<ol start="7" style="list-style-type: decimal">
<li>Add variables from <code>us_states_df</code> to <code>us_states</code> and create a new object called <code>us_states_stats</code>. What is the best function to do it? Which variable is the key in the both datasets? What is the class of a new object?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_stats =<span class="st"> </span>us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(us_states_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"NAME"</span> =<span class="st"> "state"</span>))
<span class="kw">class</span>(us_states_stats)
<span class="co">#&gt; [1] "sf"         "data.frame"</span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>
<code>us_states_df</code> has two more variables than <code>us_states</code>. How you can find them?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states_df <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">anti_join</span>(us_states, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"state"</span> =<span class="st"> "NAME"</span>))
<span class="co">#&gt; # A tibble: 2 x 5</span>
<span class="co">#&gt;   sta… median_income_10 median_income_15 poverty_level_10 poverty_level_15</span>
<span class="co">#&gt;   &lt;ch&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Ala…            29509            31455            64245            72957</span>
<span class="co">#&gt; 2 Haw…            29945            31051           124627           153944</span></code></pre></div>
<!-- Attribute creation -->
<ol start="9" style="list-style-type: decimal">
<li>What was the population density in 2015 in each state? What was the population density in 2010 in each state?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states2 =<span class="st"> </span>us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop_dens_15 =</span> total_pop_<span class="dv">15</span><span class="op">/</span>AREA,
         <span class="dt">pop_dens_10 =</span> total_pop_<span class="dv">10</span><span class="op">/</span>AREA)</code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>How much the population density changed between 2010 and 2015 in each state? Calculate the change in percentages.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop_dens_diff_10_15 =</span> pop_dens_<span class="dv">15</span> <span class="op">-</span><span class="st"> </span>pop_dens_<span class="dv">10</span>,
         <span class="dt">pop_dens_diff_10_15p =</span> (pop_dens_diff_10_<span class="dv">15</span><span class="op">/</span>pop_dens_<span class="dv">15</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)
<span class="co">#&gt; Simple feature collection with 49 features and 10 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    GEOID        NAME   REGION           AREA total_pop_10 total_pop_15</span>
<span class="co">#&gt; 1     01     Alabama    South 133709.27 km^2      4712651      4830620</span>
<span class="co">#&gt; 2     04     Arizona     West 295281.25 km^2      6246816      6641928</span>
<span class="co">#&gt; 3     08    Colorado     West 269573.06 km^2      4887061      5278906</span>
<span class="co">#&gt; 4     09 Connecticut Norteast  12976.59 km^2      3545837      3593222</span>
<span class="co">#&gt; 5     12     Florida    South 151052.01 km^2     18511620     19645772</span>
<span class="co">#&gt; 6     13     Georgia    South 152725.21 km^2      9468815     10006693</span>
<span class="co">#&gt; 7     16       Idaho     West 216512.66 km^2      1526797      1616547</span>
<span class="co">#&gt; 8     18     Indiana  Midwest  93648.40 km^2      6417398      6568645</span>
<span class="co">#&gt; 9     20      Kansas  Midwest 213037.08 km^2      2809329      2892987</span>
<span class="co">#&gt; 10    22   Louisiana    South 122345.76 km^2      4429940      4625253</span>
<span class="co">#&gt;          pop_dens_15       pop_dens_10 pop_dens_diff_10_15</span>
<span class="co">#&gt; 1   36.127786 1/km^2  35.245506 1/km^2    0.8822799 1/km^2</span>
<span class="co">#&gt; 2   22.493565 1/km^2  21.155478 1/km^2    1.3380870 1/km^2</span>
<span class="co">#&gt; 3   19.582469 1/km^2  18.128893 1/km^2    1.4535763 1/km^2</span>
<span class="co">#&gt; 4  276.900364 1/km^2 273.248788 1/km^2    3.6515761 1/km^2</span>
<span class="co">#&gt; 5  130.059657 1/km^2 122.551303 1/km^2    7.5083545 1/km^2</span>
<span class="co">#&gt; 6   65.520897 1/km^2  61.999029 1/km^2    3.5218677 1/km^2</span>
<span class="co">#&gt; 7    7.466293 1/km^2   7.051768 1/km^2    0.4145254 1/km^2</span>
<span class="co">#&gt; 8   70.141565 1/km^2  68.526513 1/km^2    1.6150517 1/km^2</span>
<span class="co">#&gt; 9   13.579734 1/km^2  13.187042 1/km^2    0.3926922 1/km^2</span>
<span class="co">#&gt; 10  37.804767 1/km^2  36.208365 1/km^2    1.5964018 1/km^2</span>
<span class="co">#&gt;    pop_dens_diff_10_15p                       geometry</span>
<span class="co">#&gt; 1            2.442109 1 MULTIPOLYGON (((-88.20006 3...</span>
<span class="co">#&gt; 2            5.948755 1 MULTIPOLYGON (((-114.7196 3...</span>
<span class="co">#&gt; 3            7.422845 1 MULTIPOLYGON (((-109.0501 4...</span>
<span class="co">#&gt; 4            1.318733 1 MULTIPOLYGON (((-73.48731 4...</span>
<span class="co">#&gt; 5            5.773008 1 MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 6            5.375182 1 MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 7            5.551957 1 MULTIPOLYGON (((-116.916 45...</span>
<span class="co">#&gt; 8            2.302560 1 MULTIPOLYGON (((-87.52404 4...</span>
<span class="co">#&gt; 9            2.891752 1 MULTIPOLYGON (((-102.0517 4...</span>
<span class="co">#&gt; 10           4.222753 1 MULTIPOLYGON (((-92.01783 2...</span></code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>Change the columns names in <code>us_states</code> to lowercase. Try to use two helper functions - <code>tolower()</code> and <code>colnames()</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">set_names</span>(<span class="kw">tolower</span>(<span class="kw">colnames</span>(.)))
<span class="co">#&gt; Simple feature collection with 49 features and 6 fields</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    geoid        name   region           area total_pop_10 total_pop_15</span>
<span class="co">#&gt; 1     01     Alabama    South 133709.27 km^2      4712651      4830620</span>
<span class="co">#&gt; 2     04     Arizona     West 295281.25 km^2      6246816      6641928</span>
<span class="co">#&gt; 3     08    Colorado     West 269573.06 km^2      4887061      5278906</span>
<span class="co">#&gt; 4     09 Connecticut Norteast  12976.59 km^2      3545837      3593222</span>
<span class="co">#&gt; 5     12     Florida    South 151052.01 km^2     18511620     19645772</span>
<span class="co">#&gt; 6     13     Georgia    South 152725.21 km^2      9468815     10006693</span>
<span class="co">#&gt; 7     16       Idaho     West 216512.66 km^2      1526797      1616547</span>
<span class="co">#&gt; 8     18     Indiana  Midwest  93648.40 km^2      6417398      6568645</span>
<span class="co">#&gt; 9     20      Kansas  Midwest 213037.08 km^2      2809329      2892987</span>
<span class="co">#&gt; 10    22   Louisiana    South 122345.76 km^2      4429940      4625253</span>
<span class="co">#&gt;                          geometry</span>
<span class="co">#&gt; 1  MULTIPOLYGON (((-88.20006 3...</span>
<span class="co">#&gt; 2  MULTIPOLYGON (((-114.7196 3...</span>
<span class="co">#&gt; 3  MULTIPOLYGON (((-109.0501 4...</span>
<span class="co">#&gt; 4  MULTIPOLYGON (((-73.48731 4...</span>
<span class="co">#&gt; 5  MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 6  MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 7  MULTIPOLYGON (((-116.916 45...</span>
<span class="co">#&gt; 8  MULTIPOLYGON (((-87.52404 4...</span>
<span class="co">#&gt; 9  MULTIPOLYGON (((-102.0517 4...</span>
<span class="co">#&gt; 10 MULTIPOLYGON (((-92.01783 2...</span></code></pre></div>
<!-- Mixed exercises -->
<!-- combination of use of select, mutate, group_by, summarize, etc  -->
<ol start="12" style="list-style-type: decimal">
<li>Using <code>us_states</code> and <code>us_states_df</code> create a new object called <code>us_states_sel</code>. The new object should have only two variables - <code>median_income_15</code> and <code>geometry</code>. Change the name of the <code>median_income_15</code> column to <code>Income</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(us_states_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"NAME"</span> =<span class="st"> "state"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="dt">Income =</span> median_income_<span class="dv">15</span>)
<span class="co">#&gt; Simple feature collection with 49 features and 1 field</span>
<span class="co">#&gt; geometry type:  MULTIPOLYGON</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -124.7042 ymin: 24.55868 xmax: -66.9824 ymax: 49.38436</span>
<span class="co">#&gt; epsg (SRID):    4269</span>
<span class="co">#&gt; proj4string:    +proj=longlat +datum=NAD83 +no_defs</span>
<span class="co">#&gt; First 10 features:</span>
<span class="co">#&gt;    Income                       geometry</span>
<span class="co">#&gt; 1   22890 MULTIPOLYGON (((-88.20006 3...</span>
<span class="co">#&gt; 2   26156 MULTIPOLYGON (((-114.7196 3...</span>
<span class="co">#&gt; 3   30752 MULTIPOLYGON (((-109.0501 4...</span>
<span class="co">#&gt; 4   33226 MULTIPOLYGON (((-73.48731 4...</span>
<span class="co">#&gt; 5   24654 MULTIPOLYGON (((-81.81169 2...</span>
<span class="co">#&gt; 6   25588 MULTIPOLYGON (((-85.60516 3...</span>
<span class="co">#&gt; 7   23558 MULTIPOLYGON (((-116.916 45...</span>
<span class="co">#&gt; 8   25834 MULTIPOLYGON (((-87.52404 4...</span>
<span class="co">#&gt; 9   27315 MULTIPOLYGON (((-102.0517 4...</span>
<span class="co">#&gt; 10  24014 MULTIPOLYGON (((-92.01783 2...</span></code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li>Calculate the change in median income between 2010 and 2015 for each state. What was the minimum, average and maximum median income in 2015 for each region? What is the region with the largest increase of the median income?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(us_states_df, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"NAME"</span> =<span class="st"> "state"</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">income_change =</span> median_income_<span class="dv">15</span> <span class="op">-</span><span class="st"> </span>median_income_<span class="dv">10</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min_income_change =</span> <span class="kw">min</span>(income_change),
            <span class="dt">mean_income_change =</span> <span class="kw">mean</span>(income_change),
            <span class="dt">max_income_change =</span> <span class="kw">max</span>(income_change)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(mean_income_change <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(mean_income_change)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pull</span>(REGION) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.character</span>()
<span class="co">#&gt; [1] "Midwest"</span></code></pre></div>
<ol start="14" style="list-style-type: decimal">
<li>Create a raster from scratch with nine rows and columns and a resolution of 0.5 decimal degrees (WGS84). Fill it with random numbers. Extract the values of the four corner cells.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
<span class="co">#&gt; Loading required package: sp</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'raster'</span>
<span class="co">#&gt; The following object is masked from 'package:dplyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     select</span>
<span class="co">#&gt; The following object is masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     extract</span>
r =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="dt">nrow =</span> <span class="dv">9</span>, <span class="dt">ncol =</span> <span class="dv">9</span>, <span class="dt">res =</span> <span class="fl">0.5</span>, <span class="dt">xmn =</span> <span class="dv">0</span>, <span class="dt">xmx =</span> <span class="fl">4.5</span>,
           <span class="dt">ymn =</span> <span class="dv">0</span>, <span class="dt">ymx =</span> <span class="fl">4.5</span>, <span class="dt">vals =</span> <span class="kw">rnorm</span>(<span class="dv">81</span>))
<span class="co"># using cell IDs</span>
r[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">81</span> <span class="op">-</span><span class="st"> </span><span class="dv">9</span>, <span class="dv">81</span>)]
<span class="co">#&gt; [1] -0.7275977 -1.2722493  1.1188654 -1.1453849</span>
<span class="co"># using indexing</span>
r[<span class="kw">c</span>(<span class="dv">1</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(r)), <span class="kw">c</span>(<span class="dv">1</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">ncol</a></span>(r))]
<span class="co">#&gt; [1] -0.7275977 -1.2722493 -1.2898390 -1.1453849</span>
<span class="co"># corresponds to [1, 1], [1, 9], [9, 1], [9, 9]</span></code></pre></div>
<ol start="15" style="list-style-type: decimal">
<li>What is the most common class of our example raster <code>grain</code> (hint: <code><a href="http://www.rdocumentation.org/packages/raster/topics/modal">modal()</a></code>)?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grain_size =<span class="st"> </span><span class="kw">c</span>(<span class="st">"clay"</span>, <span class="st">"silt"</span>, <span class="st">"sand"</span>)
grain =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="dt">nrow =</span> <span class="dv">6</span>, <span class="dt">ncol =</span> <span class="dv">6</span>, <span class="dt">res =</span> <span class="fl">0.5</span>, 
               <span class="dt">xmn =</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="dt">xmx =</span> <span class="fl">1.5</span>, <span class="dt">ymn =</span> <span class="op">-</span><span class="fl">1.5</span>, <span class="dt">ymx =</span> <span class="fl">1.5</span>,
               <span class="dt">vals =</span> <span class="kw">factor</span>(<span class="kw">sample</span>(grain_size, <span class="dv">36</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), 
                             <span class="dt">levels =</span> grain_size))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/cellStats">cellStats</a></span>(grain, modal) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/factor">factorValues</a></span>(grain, .)
<span class="co">#&gt;   VALUE</span>
<span class="co">#&gt; 1  silt</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/factor">factorValues</a></span>(grain, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/modal">modal</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getValues">values</a></span>(grain)))
<span class="co">#&gt;   VALUE</span>
<span class="co">#&gt; 1  silt</span></code></pre></div>
<ol start="16" style="list-style-type: decimal">
<li>Plot the histogram and the boxplot of the <code>data(dem, package = "RQGIS")</code> raster.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(dem, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/hist">hist</a></span>(dem)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/boxplot">boxplot</a></span>(dem)</code></pre></div>
<p><img src="solutions_files/figure-html/unnamed-chunk-21-1.png" width="700"> 17. Now attach also <code>data(ndvi, package = "RQGIS")</code>. Create a raster stack using <code>dem</code> and <code>ndvi</code>, and make a <code><a href="http://www.rdocumentation.org/packages/raster/topics/pairs">pairs()</a></code> plot</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(ndvi, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)
s =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/stack">stack</a></span>(dem, ndvi)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/pairs">pairs</a></span>(s)</code></pre></div>
<p><img src="solutions_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div id="chapter-4" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-4" class="anchor"></a>Chapter 4</h1>
<ol start="4" style="list-style-type: decimal">
<li>Use <code>data(dem, package = "RQGIS")</code>, and reclassify the elevation in three classes: low, middle and high. Secondly, compute the NDVI (<code>data(ndvi, package = "RQGIS")</code>) and the mean elevation for each altitudinal class.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(classInt)
<span class="kw">data</span>(dem, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)
<span class="kw">summary</span>(dem)
<span class="co">#&gt;          dem</span>
<span class="co">#&gt; Min.     238</span>
<span class="co">#&gt; 1st Qu.  366</span>
<span class="co">#&gt; Median   478</span>
<span class="co">#&gt; 3rd Qu.  748</span>
<span class="co">#&gt; Max.    1094</span>
<span class="co">#&gt; NA's       0</span>
<span class="co"># find quantile breaks</span>
brk =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/classInt/topics/classIntervals">classIntervals</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getValues">values</a></span>(dem), <span class="dt">n =</span> <span class="dv">3</span>)<span class="op">$</span>brk
<span class="co"># also try</span>
<span class="co"># breask = classIntervals(values(dem), n = 3, style = "fisher")</span>
<span class="co"># construct reclassification matrix</span>
rcl =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(brk[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, brk[<span class="dv">2</span>], <span class="dv">1</span>, brk[<span class="dv">2</span>], brk[<span class="dv">3</span>], <span class="dv">2</span>, brk[<span class="dv">3</span>], brk[<span class="dv">4</span>], <span class="dv">3</span>), 
             <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
<span class="co"># reclassify altitudinal raster</span>
recl =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/reclassify">reclassify</a></span>(dem, <span class="dt">rcl =</span> rcl)
<span class="co"># compute the mean dem and ndvi values for each class</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/zonal">zonal</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/stack">stack</a></span>(dem, ndvi), recl, <span class="dt">fun =</span> <span class="st">"mean"</span>)
<span class="co">#&gt;      zone      dem       ndvi</span>
<span class="co">#&gt; [1,]    1 329.7571 -0.3473349</span>
<span class="co">#&gt; [2,]    2 492.8862 -0.1311101</span>
<span class="co">#&gt; [3,]    3 846.9908 -0.2944226</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Apply a line detection filter to <code>data(dem, package = "RQGIS")</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># from the focal help page:</span>
<span class="co"># Laplacian filter: filter=matrix(c(0,1,0,1,-4,1,0,1,0), nrow=3)</span>
<span class="co"># Sobel filter: filter=matrix(c(1,2,1,0,0,0,-1,-2,-1) / 4, nrow=3)</span>
<span class="co"># compute the Sobel filter</span>
<span class="co"># check if there are NAs</span>
<span class="kw">is.na</span>(dem)  <span class="co"># just 0s, so no NAs</span>
<span class="co">#&gt; class       : RasterLayer </span>
<span class="co">#&gt; dimensions  : 117, 117, 13689  (nrow, ncol, ncell)</span>
<span class="co">#&gt; resolution  : 30.85, 30.85  (x, y)</span>
<span class="co">#&gt; extent      : 794599.1, 798208.6, 8931775, 8935384  (xmin, xmax, ymin, ymax)</span>
<span class="co">#&gt; coord. ref. : +proj=utm +zone=17 +south +ellps=WGS84 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs </span>
<span class="co">#&gt; data source : in memory</span>
<span class="co">#&gt; names       : layer </span>
<span class="co">#&gt; values      : 0, 0  (min, max)</span>
sobel =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/focal">focal</a></span>(dem, <span class="dt">w =</span> <span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">2</span>, <span class="op">-</span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">4</span>, <span class="dt">nrow =</span> <span class="dv">3</span>))
<span class="co"># CHECK IF THIS IS CORRECT</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Calculate the NDVI of a Landsat image. Use the Landsat image provided by the <strong>spDataLarge</strong> package (<code>system.file("raster/landsat.tif", package="spDataLarge")</code>).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">file =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"raster/landsat.tif"</span>, <span class="dt">package=</span><span class="st">"spDataLarge"</span>)
r =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/stack">stack</a></span>(file)
<span class="co"># compute NDVI manually</span>
ndvi =<span class="st"> </span>(r[[<span class="st">"landsat.4"</span>]] <span class="op">-</span><span class="st"> </span>r[[<span class="st">"landsat.3"</span>]]) <span class="op">/</span><span class="st"> </span>(r[[<span class="st">"landsat.4"</span>]] <span class="op">+</span><span class="st"> </span>r[[<span class="st">"landsat.3"</span>]])
<span class="co"># compute NDVI with the help of RStoolbox</span>
<span class="kw">library</span>(RStoolbox)
ndvi_rstoolbox =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/RStoolbox/topics/spectralIndices">spectralIndices</a></span>(r, <span class="dt">red =</span> <span class="dv">3</span>, <span class="dt">nir =</span> <span class="dv">4</span>, <span class="dt">indices =</span> <span class="st">"NDVI"</span>)
<span class="kw">all.equal</span>(ndvi, ndvi_rstoolbox)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>This <a href="https://stackoverflow.com/questions/35555709/global-raster-of-geographic-distances">post</a> shows how to use <code><a href="http://www.rdocumentation.org/packages/raster/topics/distance">raster::distance()</a></code>. Extract Spain, calculate a distance raster and weight it with elevation. Finally, compute the difference between the raster using the euclidean distance and the raster weighted by elevation. (Hint: Have a look at <code><a href="http://www.rdocumentation.org/packages/raster/topics/getData">getData()</a></code> to retrieve a digital elevation model for Spain.)</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
<span class="co"># find out the ISO_3 code of Spain</span>
dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getData">ccodes</a></span>(), NAME <span class="op">%in%</span><span class="st"> "Spain"</span>)
<span class="co">#&gt;    NAME ISO3 ISO2 NAME_ISO NAME_FAO NAME_LOCAL SOVEREIGN       UNREGION1</span>
<span class="co">#&gt; 1 Spain  ESP   ES    SPAIN    Spain     España    España Southern Europe</span>
<span class="co">#&gt;   UNREGION2 CONTINENT</span>
<span class="co">#&gt; 1    Europe    Europe</span>
<span class="co"># retrieve a dem of Spain</span>
dem =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getData">getData</a></span>(<span class="st">"alt"</span>, <span class="dt">country =</span> <span class="st">"ESP"</span>, <span class="dt">mask =</span> <span class="ot">FALSE</span>)
<span class="co"># change the resolution to decrease computing time</span>
agg =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/aggregate">aggregate</a></span>(dem, <span class="dt">fact =</span> <span class="dv">5</span>)
poly =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/getData">getData</a></span>(<span class="st">"GADM"</span>, <span class="dt">country =</span> <span class="st">"ESP"</span>, <span class="dt">level =</span> <span class="dv">1</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(dem)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(poly, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="solutions_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># visualize NAs</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw">is.na</span>(agg))</code></pre></div>
<p><img src="solutions_files/figure-html/unnamed-chunk-26-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># construct a distance input raster</span>
<span class="co"># we have to set the land cells to NA and the sea cells to an arbitrary value since </span>
<span class="co"># raster::distance computes the distance to the nearest non-NA cell</span>
dist =<span class="st"> </span><span class="kw">is.na</span>(agg)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/cellStats">cellStats</a></span>(dist, summary)
<span class="co">#&gt;    Mode   FALSE    TRUE </span>
<span class="co">#&gt; logical   44595   24793</span>
<span class="co"># convert land cells into NAs and sea cells into 1s</span>
dist[dist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>] =<span class="st"> </span><span class="ot">NA</span>
dist[dist <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>] =<span class="st"> </span><span class="dv">1</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(dist)</code></pre></div>
<p><img src="solutions_files/figure-html/unnamed-chunk-26-3.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># compute distance to nearest non-NA cell</span>
dist =<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/distance">distance</a></span>(dist)
<span class="co"># just keep Spain</span>
dist =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(dist, poly)
<span class="co"># convert distance into km</span>
dist =<span class="st"> </span>dist <span class="op">/</span><span class="st"> </span><span class="dv">1000</span>
<span class="co"># now let's weight each 100 altitudinal meters by an additionaly distance of 10 km</span>
agg =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(agg, poly)
agg[agg <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] =<span class="st"> </span><span class="dv">0</span>
weight =<span class="st"> </span>dist <span class="op">+</span><span class="st"> </span>agg <span class="op">/</span><span class="st"> </span><span class="dv">100</span> <span class="op">*</span><span class="st"> </span><span class="dv">10</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(weight <span class="op">-</span><span class="st"> </span>dist)</code></pre></div>
<p><img src="solutions_files/figure-html/unnamed-chunk-26-4.png" width="700"></p>
</div>
<div id="chapter-5" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-5" class="anchor"></a>Chapter 5</h1>
</div>
<div id="chapter-8-location-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-8-location-analysis" class="anchor"></a>Chapter 8 Location analysis</h1>
<ol style="list-style-type: decimal">
<li>Donwload the csv file containing inhabitant information for a 100 m cell resolution ( <a href="https://www.zensus2011.de/SharedDocs/Downloads/DE/Pressemitteilung/DemografischeGrunddaten/csv_Bevoelkerung_100m_Gitter.zip?__blob=publicationFile&amp;v=3" class="uri">https://www.zensus2011.de/SharedDocs/Downloads/DE/Pressemitteilung/DemografischeGrunddaten/csv_Bevoelkerung_100m_Gitter.zip?__blob=publicationFile&amp;v=3</a>). Please note that the unzipped file has a size of 1.23 GB. To read it into R you can use <code><a href="http://www.rdocumentation.org/packages/readr/topics/read_delim">readr::read_csv</a></code>. This takes 30 seconds on my machine (16 GB RAM) <code><a href="http://www.rdocumentation.org/packages/data.table/topics/fread">data.table::fread()</a></code> might be even faster, and returns an object of class <code>data.table()</code>. Use <code>as.tibble()</code> to convert it into a tibble. Build an inhabitant raster, aggregate it to a cell resolution of 1 km, and compare the difference with the inhabitant raster (<code>inh</code>) we have created using class mean values.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(raster)
<span class="kw">library</span>(sp)

build_census_raster =<span class="st"> </span><span class="cf">function</span>(url) {
  <span class="kw">download.file</span>(<span class="dt">url =</span> url, <span class="dt">destfile =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"census.zip"</span>),
                <span class="dt">method =</span> <span class="st">"auto"</span>, <span class="dt">mode =</span> <span class="st">"wb"</span>)
  <span class="co"># list the file names</span>
  nms =<span class="st"> </span><span class="kw">unzip</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"census.zip"</span>), <span class="dt">list =</span> <span class="ot">TRUE</span>)
  <span class="co"># unzip only the csv file</span>
  base_name =<span class="st"> </span><span class="kw">grep</span>(<span class="st">".csv$"</span>, nms<span class="op">$</span>Name, <span class="dt">value =</span> <span class="ot">TRUE</span>)
  <span class="kw">unzip</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"census.zip"</span>), <span class="dt">files =</span> base_name, <span class="dt">exdir =</span> <span class="kw">tempdir</span>())
  <span class="co"># read in the csv file</span>
  input =<span class="st"> </span>data.table<span class="op">::</span><span class="kw">fread</span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), base_name)) <span class="op">%&gt;%</span>
<span class="st">    </span>as.tibble
  input =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(input, <span class="dt">x =</span> <span class="kw">starts_with</span>(<span class="st">"x_mp_1"</span>), <span class="dt">y =</span> <span class="kw">starts_with</span>(<span class="st">"y_mp_1"</span>),
                        <span class="dt">inh =</span> Einwohner)
  <span class="co"># set -1 and -9 to NA</span>
  input =<span class="st"> </span><span class="kw">mutate_all</span>(input, <span class="kw">funs</span>(<span class="kw">ifelse</span>(. <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="op">-</span><span class="dv">9</span>), <span class="ot">NA</span>, .)))
  <span class="co"># convert table into a raster (x and y are cell midpoints)</span>
  <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/coordinates">coordinates</a></span>(input) =<span class="er">~</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y
  <span class="co"># use the correct projection</span>
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/projection">proj4string</a></span>(input) =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/CRS-class">CRS</a></span>(<span class="st">"+init=epsg:3035"</span>)
  <span class="kw"><a href="http://www.rdocumentation.org/packages/sp/topics/gridded-methods">gridded</a></span>(input) =<span class="st"> </span><span class="ot">TRUE</span>
  <span class="co"># convert into a raster stack</span>
  <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(input)
}

<span class="co"># download 1km resolution</span>
url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"https://www.zensus2011.de/SharedDocs/Downloads/DE/"</span>, 
             <span class="st">"Pressemitteilung/DemografischeGrunddaten/csv_Zensusatlas_"</span>, 
             <span class="st">"klassierte_Werte_1km_Gitter.zip?__blob=publicationFile&amp;v=8"</span>)
inp_coarse =<span class="st"> </span><span class="kw">build_census_raster</span>(url)
<span class="co"># reclassify</span>
rcl =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">125</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">375</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1250</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">3000</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">6000</span>,
               <span class="dv">6</span>, <span class="dv">6</span>, <span class="dv">8000</span>), <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
inh_coarse =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/reclassify">reclassify</a></span>(inp_coarse, <span class="dt">rcl =</span> rcl, <span class="dt">right =</span> <span class="ot">NA</span>)

<span class="co"># Download and build 1km inhabitant raster</span>
url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"https://www.zensus2011.de/SharedDocs/Downloads/DE/Pressemitteilung/"</span>,
             <span class="st">"DemografischeGrunddaten/csv_Bevoelkerung_100m_Gitter.zip"</span>, 
             <span class="st">"?__blob=publicationFile&amp;v=3"</span>)
inh_fine =<span class="st"> </span><span class="kw">build_census_raster</span>(url)
inh_fine =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/aggregate">aggregate</a></span>(inh_fine, <span class="dt">fact =</span> <span class="dv">1000</span> <span class="op">/</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/resolution">res</a></span>(inp_fine)[<span class="dv">1</span>], <span class="dt">fun =</span> sum)
inh_fine <span class="op">-</span><span class="st"> </span>inh_coarse  <span class="co"># origin has to be the same</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/origin">origin</a></span>(inh_fine) =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/origin">origin</a></span>(inh_coarse)
<span class="kw">summary</span>(inh_fine <span class="op">-</span><span class="st"> </span>inh_coarse)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(inh_fine <span class="op">-</span><span class="st"> </span>inh_coarse)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(<span class="kw">abs</span>(inh_fine <span class="op">-</span><span class="st"> </span>inh_coarse) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/cellStats">cellStats</a></span>((<span class="kw">abs</span>(inh_fine <span class="op">-</span><span class="st"> </span>inh_coarse) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1000</span>), <span class="dt">stat =</span> <span class="st">"sum"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/cellStats">cellStats</a></span>((<span class="kw">abs</span>(inh_fine <span class="op">-</span><span class="st"> </span>inh_coarse) <span class="op">&gt;</span><span class="st"> </span><span class="dv">5000</span>), <span class="dt">stat =</span> <span class="st">"sum"</span>)</code></pre></div>
</div>
<div id="chapter-r-gis-bridges" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-r-gis-bridges" class="anchor"></a>Chapter R-GIS bridges</h1>
<ol style="list-style-type: decimal">
<li>Create two overlapping polygons (<code>poly_1</code> and <code>poly_2</code>) with the help of the <strong>sf</strong>-package (see Chapter 2).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="co"># create two polygons</span>
coords_<span class="dv">1</span> =<span class="st">  </span>
<span class="st">  </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>),
         <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
coords_<span class="dv">2</span> =
<span class="st">  </span><span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, 
                  <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.5</span>),
         <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)

<span class="co"># create the first polygon</span>
poly_<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st">st_polygon</a></span>(<span class="kw">list</span>((coords_<span class="dv">1</span>))) 
<span class="co"># convert it into a simple feature collection </span>
poly_<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(poly_<span class="dv">1</span>)
poly_<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(poly_<span class="dv">1</span>, <span class="dt">crs =</span> <span class="dv">4326</span>)
<span class="co"># finally, convert it into an sf-object</span>
poly_<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/sf">st_sf</a></span>(<span class="dt">geometry =</span> poly_<span class="dv">1</span>, <span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="dv">1</span>))

<span class="co"># create a second polygon</span>
poly_<span class="dv">2</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st">st_polygon</a></span>(<span class="kw">list</span>((coords_<span class="dv">2</span>))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(., <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/sf">st_sf</a></span>(<span class="dt">geometry =</span> ., <span class="dt">data =</span> <span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="dv">1</span>))
<span class="co"># visualize it</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">1</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">2</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Union <code>poly_1</code> and <code>poly_2</code> using <code><a href="http://www.rdocumentation.org/packages/sf/topics/geos_combine">st_union()</a></code> and <code>qgis:union</code>. What is the difference between the two union operations? How can we use the <strong>sf</strong> package to obtain the same result as QGIS?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">"RQGIS"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/set_env">set_env</a></span>(<span class="dt">dev =</span> <span class="ot">FALSE</span>)
union_sf =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/geos_combine">st_union</a></span>(poly_<span class="dv">1</span>, poly_<span class="dv">2</span>)
union_qgis =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/run_qgis">run_qgis</a></span>(<span class="st">"qgis:union"</span>, <span class="dt">INPUT =</span> poly_<span class="dv">1</span>, <span class="dt">INPUT2 =</span> poly_<span class="dv">2</span>,
                 <span class="dt">OUTPUT =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"union.shp"</span>),
                 <span class="dt">load_output =</span> <span class="ot">TRUE</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(union_sf), <span class="dt">main =</span> <span class="st">"st_union"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(union_qgis), <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">main =</span> <span class="st">"QGIS union"</span>)
<span class="co"># achieve the QGIS result using sf</span>
int =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/geos_binary_ops">st_intersection</a></span>(poly_<span class="dv">1</span>, poly_<span class="dv">2</span>)
<span class="co"># difference_1</span>
diff_<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/geos_binary_ops">st_sym_difference</a></span>(poly_<span class="dv">1</span>, poly_<span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_cast">st_cast</a></span>(<span class="st">"POLYGON"</span>)
<span class="co"># the same as:</span>
<span class="co"># diff_2 = st_difference(poly_1, poly_2)</span>
<span class="co"># diff_3 = st_difference(poly_2, poly_1)</span>
<span class="co"># rbind(diff_2, diff_3)</span>
union_sf_<span class="dv">2</span> =<span class="st"> </span><span class="kw">rbind</span>(int, diff_<span class="dv">1</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(union_sf_<span class="dv">2</span>), <span class="dt">col =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Calculate the intersection of <code>poly_1</code> and <code>poly_2</code> using:</li>
</ol>
<ul>
<li>
<strong>RQGIS</strong>, <strong>RSAGA</strong> and <strong>rgrass7</strong>
</li>
<li><strong>sf</strong></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="kw">library</span>(RQGIS)

<span class="co"># INTERSECTION USING RQGIS</span>
<span class="co">#***************************</span>
<span class="co"># first of all, we need to find out which function might do this for us</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/find_algorithms">find_algorithms</a></span>(<span class="st">"intersec"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/open_help">open_help</a></span>(<span class="st">"qgis:intersection"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/get_usage">get_usage</a></span>(<span class="st">"qgis:intersection"</span>)
<span class="co"># using R named arguments#</span>
int_qgis =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/run_qgis">run_qgis</a></span>(<span class="st">"qgis:intersection"</span>, <span class="dt">INPUT =</span> poly_<span class="dv">1</span>, <span class="dt">INPUT2 =</span> poly_<span class="dv">2</span>,
                    <span class="dt">OUTPUT =</span> <span class="st">"int_qgis.shp"</span>, <span class="dt">load_output =</span> <span class="ot">TRUE</span>)
<span class="co"># visualize it</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">1</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">2</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(int_qgis, <span class="dt">col =</span> <span class="st">"lightblue"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)


<span class="co"># INTERSECTION USING RSAGA</span>
<span class="co">#***************************</span>
<span class="co"># The RSAGA examples only work with SAGA &lt; 2.3. We have informed the</span>
<span class="co"># package maintainer to update SAGA</span>
<span class="kw">library</span>(RSAGA)
<span class="kw">library</span>(link2GI)
<span class="kw"><a href="http://www.rdocumentation.org/packages/link2GI/topics/linkSAGA">linkSAGA</a></span>()
<span class="kw"><a href="http://www.rdocumentation.org/packages/RSAGA/topics/rsaga.env">rsaga.env</a></span>()
<span class="co"># save shapefile layers</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_write">write_sf</a></span>(poly_<span class="dv">1</span>, <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"poly_1.shp"</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_write">write_sf</a></span>(poly_<span class="dv">2</span>, <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"poly_2.shp"</span>))
<span class="co"># find out how to union shapefiles with the help of SAGA</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RSAGA/topics/rsaga.get.modules">rsaga.get.modules</a></span>(<span class="dt">lib =</span> <span class="st">"shapes_polygons"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/RSAGA/topics/rsaga.get.usage">rsaga.get.usage</a></span>(<span class="dt">lib =</span> <span class="st">"shapes_polygons"</span>, <span class="dt">module =</span> <span class="st">"Intersect"</span>)
<span class="co"># create parameter-argument list for RSAGA</span>
params =<span class="st"> </span><span class="kw">list</span>(<span class="dt">A =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"poly_1.shp"</span>),
              <span class="dt">B =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"poly_2.shp"</span>),
              <span class="dt">RESULT =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"int_saga.shp"</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/RSAGA/topics/rsaga.geoprocessor">rsaga.geoprocessor</a></span>(<span class="dt">lib =</span> <span class="st">"shapes_polygons"</span>, <span class="dt">module =</span> <span class="st">"Intersect"</span>, 
                   <span class="dt">param =</span> params)
int_saga =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_read">st_read</a></span>(<span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"int_saga.shp"</span>))
<span class="co"># visualize it</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">1</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">2</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(int_saga), <span class="dt">col =</span> <span class="st">"lightblue"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)

<span class="co"># INTERSECTION USING rgrass7</span>
<span class="co">#***************************</span>
<span class="kw">library</span>(link2GI)
<span class="kw">library</span>(rgrass7)
link2GI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/link2GI/topics/linkGRASS7">linkGRASS7</a></span>(<span class="kw">rbind</span>(poly_<span class="dv">1</span>, poly_<span class="dv">2</span>), <span class="dt">ver_select =</span> <span class="ot">TRUE</span>)
<span class="co"># let's have a look at the help of v.overlay via rgrass7</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/execGRASS">execGRASS</a></span>(<span class="st">"g.manual"</span>, <span class="dt">entry =</span> <span class="st">"v.overlay"</span>)
<span class="co"># RQGIS::open_help("grass7:v.overlay")</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/readVECT">writeVECT</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(poly_<span class="dv">1</span>, <span class="st">"Spatial"</span>), <span class="dt">vname =</span> <span class="st">"poly_1"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/readVECT">writeVECT</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(poly_<span class="dv">2</span>, <span class="st">"Spatial"</span>), <span class="dt">vname =</span> <span class="st">"poly_2"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/execGRASS">execGRASS</a></span>(<span class="st">"v.overlay"</span>, <span class="dt">ainput =</span> <span class="st">"poly_1"</span>, <span class="dt">binput =</span> <span class="st">"poly_2"</span>,
          <span class="dt">output =</span> <span class="st">"int_grass"</span>, <span class="dt">operator =</span> <span class="st">"and"</span>, <span class="dt">flag =</span> <span class="st">"overwrite"</span>)
out_grass =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/readVECT">readVECT</a></span>(<span class="st">"int_grass"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">1</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">2</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(int_grass, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"lightblue"</span>)

<span class="co"># INTERSECTION USING sf</span>
<span class="co">#***************************</span>

int_sf =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/geos_binary_ops">st_intersection</a></span>(poly_<span class="dv">1</span>, poly_<span class="dv">2</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">1</span>), <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>))
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(poly_<span class="dv">2</span>), <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(int_sf, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"lightblue"</span>)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Run <code>data(dem, package = "RQGIS")</code> and <code>data(random_points, package = "RQGIS")</code>. Select randomly a point from <code>random_points</code> and find all <code>dem</code> pixels that can be seen from this point (hint: viewshed). Visualize your result. For example, plot a hillshade, and on top of it the digital elevation model, your viewshed output and the point. Additionally, give <code>mapview</code> a try.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RQGIS)
<span class="kw">library</span>(raster)
<span class="kw">data</span>(dem, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)
<span class="kw">data</span>(random_points, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)

<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/find_algorithms">find_algorithms</a></span>(<span class="st">"viewshed"</span>)
alg =<span class="st"> "grass7:r.viewshed"</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/get_usage">get_usage</a></span>(alg)
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/open_help">open_help</a></span>(alg)
<span class="co"># let's find out about the default values</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/get_args_man">get_args_man</a></span>(alg)
point =<span class="st"> </span>random_points[<span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(random_points), <span class="dv">1</span>), ]
coord =<span class="st"> </span><span class="kw">paste</span>(sf<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_coordinates">st_coordinates</a></span>(point), <span class="dt">collapse =</span> <span class="st">","</span>)
out =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/run_qgis">run_qgis</a></span>(alg, <span class="dt">input =</span> dem,
               <span class="dt">coordinates =</span> coord,
               <span class="dt">output =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"out.tif"</span>),
               <span class="dt">load_output =</span> <span class="ot">TRUE</span>)

<span class="co"># under Linux this was tested using QGIS 2.18.22 and GRASS GIS 7.4.1. In</span>
<span class="co"># previous versions, however, "grass7:r.viewshed" might not work. In this case</span>
<span class="co"># use rgrass7 directly:</span>
<span class="kw">library</span>(rgrass7)
link2GI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/link2GI/topics/linkGRASS7">linkGRASS7</a></span>(dem, <span class="dt">ver_select =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/readRAST">writeRAST</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(dem, <span class="st">"SpatialGridDataFrame"</span>), <span class="st">"dem"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/readVECT">writeVECT</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(random_points, <span class="st">"Spatial"</span>), <span class="dt">vname =</span> <span class="st">"points"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/execGRASS">execGRASS</a></span>(<span class="st">"r.viewshed"</span>, <span class="dt">input =</span> <span class="st">"dem"</span>, <span class="dt">coordinates =</span> sf<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_coordinates">st_coordinates</a></span>(point),
          <span class="dt">output =</span> <span class="st">"view"</span>)
out =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/rgrass7/topics/readRAST">readRAST</a></span>(<span class="st">"view"</span>))

hs =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/hillShade">hillShade</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/terrain">terrain</a></span>(dem), <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/terrain">terrain</a></span>(dem, <span class="st">"aspect"</span>), <span class="dv">40</span>, <span class="dv">270</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(hs, <span class="dt">col =</span> <span class="kw">gray</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">100</span> <span class="op">/</span><span class="st"> </span><span class="dv">100</span>), <span class="dt">legend =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(dem, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">legend =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(point, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">16</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(out, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"lightgray"</span>, <span class="dt">legend =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/plot">plot</a></span>(point, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">pch =</span> <span class="dv">16</span>)

<span class="co"># or using mapview</span>
<span class="kw">library</span>(mapview)
<span class="kw"><a href="http://www.rdocumentation.org/packages/mapview/topics/mapView">mapview</a></span>(out, <span class="dt">col =</span> <span class="st">"white"</span>, <span class="dt">map.type =</span> <span class="st">"Esri.WorldImagery"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mapview/topics/mapView">mapview</a></span>(point)</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Use <code>gdalinfo</code> via a system call for a raster file stored on disk of your choice.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">link2GI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/link2GI/topics/linkGDAL">linkGDAL</a></span>()
<span class="kw">data</span>(<span class="st">"dem"</span>, <span class="dt">package =</span> <span class="st">"RQGIS"</span>)
file =<span class="st"> </span><span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"dem.tif"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/writeRaster">writeRaster</a></span>(dem, <span class="dt">filename =</span> file, <span class="dt">prj =</span> <span class="ot">TRUE</span>, <span class="dt">format =</span> <span class="st">"GTiff"</span>)
cmd =<span class="st"> </span><span class="kw">paste</span>(<span class="st">"gdalinfo"</span>, file)
<span class="kw">system</span>(cmd)</code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Query all Californian highways from the PostgreSQL/PostGIS database living in the QGIS Cloud introduced in this chapter.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RPostgreSQL)
<span class="kw">library</span>(sf)
conn =<span class="st"> </span><span class="kw">dbConnect</span>(<span class="dt">drv =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/RPostgreSQL/topics/PostgreSQL">PostgreSQL</a></span>(), <span class="dt">dbname =</span> <span class="st">"rtafdf_zljbqm"</span>,
                 <span class="dt">host =</span> <span class="st">"db.qgiscloud.com"</span>,
                 <span class="dt">port =</span> <span class="st">"5432"</span>, <span class="dt">user =</span> <span class="st">"rtafdf_zljbqm"</span>, 
                 <span class="dt">password =</span> <span class="st">"d3290ead"</span>)
query =<span class="st"> </span><span class="kw">paste</span>(
  <span class="st">"SELECT *"</span>,
  <span class="st">"FROM highways"</span>,
  <span class="st">"WHERE state = 'CA';"</span>)
ca_highways =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_read">st_read</a></span>(conn, <span class="dt">query =</span> query, <span class="dt">geom =</span> <span class="st">"wkb_geometry"</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(ca_highways))</code></pre></div>
</div>
<div id="chapter-spatial-cross-validation" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-spatial-cross-validation" class="anchor"></a>Chapter Spatial cross-validation</h1>
<ol style="list-style-type: decimal">
<li>Compute the terrain attributes slope, plan curvature, profile curvature and catchment area from <code>dem</code> (provided by <code>data("landslides", package = "RSAGA")</code>) with the help of R-GIS bridges, and extract the values from the corresponding output rasters to the <code>landslides</code> dataframe (<code>data(landslides, package = "RSAGA"</code>)). Keep all landslide initation points and 175 randomly selected non-landslide points.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># attach packages</span>
<span class="kw">library</span>(RSAGA)
<span class="kw">library</span>(RQGIS)

<span class="co"># attach data</span>
<span class="kw">data</span>(<span class="st">"landslides"</span>, <span class="dt">package =</span> <span class="st">"RSAGA"</span>)


<span class="co"># DATA PREPROCESSING</span>
<span class="co">#*******************</span>

<span class="co"># landslide points</span>
non =<span class="st"> </span>landslides[landslides<span class="op">$</span>lslpts <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>, ]
ind =<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(non), <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(landslides[landslides<span class="op">$</span>lslpts <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>, ]))
lsl =<span class="st"> </span><span class="kw">rbind</span>(non[ind, ], landslides[landslides<span class="op">$</span>lslpts <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>, ])

<span class="co"># digital elevation model</span>
dem =<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(dem<span class="op">$</span>data, 
         <span class="dt">crs =</span> <span class="st">"+proj=utm +zone=17 +south +datum=WGS84 +units=m +no_defs"</span>,
         <span class="dt">xmn =</span> dem<span class="op">$</span>header<span class="op">$</span>xllcorner, 
         <span class="dt">xmx =</span> dem<span class="op">$</span>header<span class="op">$</span>xllcorner <span class="op">+</span><span class="st"> </span>dem<span class="op">$</span>header<span class="op">$</span>ncols <span class="op">*</span><span class="st"> </span>dem<span class="op">$</span>header<span class="op">$</span>cellsize,
         <span class="dt">ymn =</span> dem<span class="op">$</span>header<span class="op">$</span>yllcorner,
         <span class="dt">ymx =</span> dem<span class="op">$</span>header<span class="op">$</span>yllcorner <span class="op">+</span><span class="st"> </span>dem<span class="op">$</span>header<span class="op">$</span>nrows <span class="op">*</span><span class="st"> </span>dem<span class="op">$</span>header<span class="op">$</span>cellsize)

<span class="co"># COMPUTING TERRAIN ATTRIBUTES</span>
<span class="co">#*******************************</span>

<span class="co"># slope, aspect, curvatures</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/set_env">set_env</a></span>(<span class="dt">dev =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/find_algorithms">find_algorithms</a></span>(<span class="st">"curvature"</span>)
alg =<span class="st"> "saga:slopeaspectcurvature"</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/get_usage">get_usage</a></span>(alg)
<span class="co"># terrain attributes (ta)</span>
out =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/run_qgis">run_qgis</a></span>(alg, <span class="dt">ELEVATION =</span> dem, <span class="dt">METHOD =</span> <span class="dv">6</span>, <span class="dt">UNIT_SLOPE =</span> <span class="st">"degree"</span>,
               <span class="dt">UNIT_ASPECT =</span> <span class="st">"degree"</span>,
               <span class="dt">ASPECT =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"aspect.tif"</span>),
               <span class="dt">SLOPE =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"slope.tif"</span>),
               <span class="dt">C_PLAN =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"cplan.tif"</span>),
               <span class="dt">C_PROF =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"cprof.tif"</span>),
               <span class="dt">load_output =</span> <span class="ot">TRUE</span>)

<span class="co"># use brick because then the layers will be in memory and not on disk</span>
ta =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/brick">brick</a></span>(out[<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/names">names</a></span>(out) <span class="op">!=</span><span class="st"> "ASPECT"</span>])
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/names">names</a></span>(ta) =<span class="st"> </span><span class="kw">c</span>(<span class="st">"slope"</span>, <span class="st">"cplan"</span>, <span class="st">"cprof"</span>)
<span class="co"># catchment area</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/find_algorithms">find_algorithms</a></span>(<span class="st">"[Cc]atchment"</span>)
alg =<span class="st"> "saga:flowaccumulationtopdown"</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/get_usage">get_usage</a></span>(alg)
carea =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/RQGIS/topics/run_qgis">run_qgis</a></span>(alg, <span class="dt">ELEVATION =</span> dem, <span class="dt">METHOD =</span> <span class="dv">4</span>, 
                 <span class="dt">FLOW =</span> <span class="kw">file.path</span>(<span class="kw">tempdir</span>(), <span class="st">"carea.tif"</span>),
                 <span class="dt">load_output =</span> <span class="ot">TRUE</span>)
<span class="co"># transform carea</span>
log_carea =<span class="st"> </span><span class="kw">log10</span>(carea)
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/names">names</a></span>(log_carea) =<span class="st"> "log_carea"</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/names">names</a></span>(dem) =<span class="st"> "elev"</span>
<span class="co"># add log_carea</span>
ta =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/addLayer">addLayer</a></span>(<span class="dt">x =</span> ta, dem, log_carea)
<span class="co"># extract values to points, i.e., create predictors</span>
lsl[, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/names">names</a></span>(ta)] =<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/extract">extract</a></span>(ta, lsl[, <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)])</code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Make a spatial prediction map similar with the derived model results and terrain attribute rasters.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># attach packages</span>
<span class="kw">library</span>(raster)
<span class="kw">library</span>(sf)
<span class="kw">library</span>(tmap)
<span class="co"># attach data (in case you have not computed the terrain attributes before)</span>
<span class="kw">load</span>(<span class="st">"extdata/spatialcv.Rdata"</span>)

<span class="co"># fit the model</span>
fit =<span class="st"> </span><span class="kw">glm</span>(lslpts <span class="op">~</span><span class="st"> </span>slope <span class="op">+</span><span class="st"> </span>cplan <span class="op">+</span><span class="st"> </span>cprof <span class="op">+</span><span class="st"> </span>elev <span class="op">+</span><span class="st"> </span>log_carea, 
          <span class="dt">data =</span> lsl, <span class="dt">family =</span> <span class="kw">binomial</span>())

<span class="co"># make the prediction</span>
pred =<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/predict">predict</a></span>(<span class="dt">object =</span> ta, <span class="dt">model =</span> fit, <span class="dt">type =</span> <span class="st">"response"</span>)

<span class="co"># make the map</span>
lsl_sf =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>(lsl, <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>), <span class="dt">crs =</span> <span class="dv">32717</span>)
hs =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/hillShade">hillShade</a></span>(ta<span class="op">$</span>slope <span class="op">*</span><span class="st"> </span>pi <span class="op">/</span><span class="st"> </span><span class="dv">180</span>, <span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/terrain">terrain</a></span>(ta<span class="op">$</span>elev, <span class="dt">opt =</span> <span class="st">"aspect"</span>))
rect =<span class="st"> </span>tmaptools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmaptools/topics/bb_poly">bb_poly</a></span>(hs)
bbx =<span class="st"> </span>tmaptools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmaptools/topics/bb">bb</a></span>(hs, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.02</span>, <span class="dv">1</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="fl">0.02</span>, <span class="dv">1</span>), <span class="dt">relative =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_shape">tm_shape</a></span>(hs, <span class="dt">bbox =</span> bbx) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_grid">tm_grid</a></span>(<span class="dt">col =</span> <span class="st">"black"</span>, <span class="dt">n.x =</span> <span class="dv">1</span>, <span class="dt">n.y =</span> <span class="dv">1</span>, <span class="dt">labels.inside.frame =</span> <span class="ot">FALSE</span>,
          <span class="dt">labels.rot =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">90</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_raster">tm_raster</a></span>(<span class="dt">palette =</span> <span class="st">"white"</span>, <span class="dt">legend.show =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="co"># hillshade</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_shape">tm_shape</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(hs, study_area), <span class="dt">bbox =</span> bbx) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_raster">tm_raster</a></span>(<span class="dt">palette =</span> <span class="kw">gray</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">100</span> <span class="op">/</span><span class="st"> </span><span class="dv">100</span>), <span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">legend.show =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">    </span><span class="co"># prediction raster</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_shape">tm_shape</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(pred, study_area)) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_raster">tm_raster</a></span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>, <span class="dt">palette =</span> RColorBrewer<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/RColorBrewer/topics/ColorBrewer">brewer.pal</a></span>(<span class="dt">name =</span> <span class="st">"Reds"</span>, <span class="dv">6</span>),
              <span class="dt">auto.palette.mapping =</span> <span class="ot">FALSE</span>, <span class="dt">legend.show =</span> <span class="ot">TRUE</span>,
              <span class="dt">title =</span> <span class="st">"Susceptibility</span><span class="ch">\n</span><span class="st">probability"</span>) <span class="op">+</span>
<span class="st">    </span><span class="co"># rectangle and outer margins</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/qtm">qtm</a></span>(rect, <span class="dt">fill =</span> <span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tmap/topics/tm_layout">tm_layout</a></span>(<span class="dt">outer.margins =</span> <span class="kw">c</span>(<span class="fl">0.04</span>, <span class="fl">0.04</span>, <span class="fl">0.02</span>, <span class="fl">0.02</span>), <span class="dt">frame =</span> <span class="ot">FALSE</span>,
              <span class="dt">legend.position =</span> <span class="kw">c</span>(<span class="st">"left"</span>, <span class="st">"bottom"</span>),
              <span class="dt">legend.title.size =</span> <span class="fl">0.9</span>)</code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Compute a non-spatial cross-validation and make boxplots to compare the AUROC from a spatial and a non-spatial CV (see Figure @ref(fig:boxplot-cv)). Hint: You need to specify a non-spatial task and a non-spatial resampling strategy. Before running the spatial cross-validation for both tasks set a seed to make sure that both use the same partitions which in turn guarantees comparability.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># attach packages</span>
<span class="kw">library</span>(mlr)
<span class="co"># attach data (in case you have not computed the terrain attributes before)</span>
<span class="kw">load</span>(<span class="st">"extdata/spatialcv.Rdata"</span>)

<span class="co"># put the coordinates in an additional dataframe</span>
coords =<span class="st"> </span>lsl[, <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]
data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(lsl, <span class="op">-</span>x, <span class="op">-</span>y)
<span class="co"># data_nonspatial = dplyr::select(data, -x, -y)</span>

<span class="co"># CREATE TASKS</span>
<span class="co">#*************</span>

<span class="co"># spatial task</span>
task =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/Task">makeClassifTask</a></span>(<span class="dt">data =</span> data, <span class="dt">target =</span> <span class="st">"lslpts"</span>, 
                       <span class="dt">positive =</span> <span class="st">"TRUE"</span>, <span class="dt">coordinates =</span> coords)
<span class="co"># non-spatial task</span>
task_nsp =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/Task">makeClassifTask</a></span>(<span class="dt">data =</span> data, <span class="dt">target =</span> <span class="st">"lslpts"</span>, <span class="dt">positive =</span> <span class="st">"TRUE"</span>)

<span class="co"># CONSTRUCT LEARNER</span>
<span class="co">#******************</span>

lrn =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"classif.binomial"</span>,
                  <span class="dt">link =</span> <span class="st">"logit"</span>,
                  <span class="dt">predict.type =</span> <span class="st">"prob"</span>)

<span class="co"># DEFINE RESAMPLING STRATEGY</span>
<span class="co">#***************************</span>

<span class="co"># 100-repeated 5-fold spatial resampling strategy</span>
resampling =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeResampleDesc">makeResampleDesc</a></span>(<span class="dt">method =</span> <span class="st">"SpRepCV"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">100</span>)
<span class="co"># 100-repeated 5-fold non-spatial resampling strategy</span>
resampling_nsp =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeResampleDesc">makeResampleDesc</a></span>(<span class="dt">method =</span> <span class="st">"RepCV"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">100</span>)

<span class="co"># (SPATIAL) CROSS-VALIDATAION</span>
<span class="co">#****************************</span>

<span class="co"># setting a seed guarantees that the same partitions are used for both spatial </span>
<span class="co"># CVs</span>
<span class="kw">set.seed</span>(<span class="dv">012348</span>)
<span class="co"># execute the resampling</span>
sp_cv =<span class="st"> </span>mlr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/resample">resample</a></span>(<span class="dt">learner =</span> lrn, <span class="dt">task =</span> task,
                      <span class="dt">resampling =</span> resampling,
                      <span class="dt">measures =</span> mlr<span class="op">::</span>auc)
conv_cv =<span class="st"> </span>mlr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/resample">resample</a></span>(<span class="dt">learner =</span> lrn, <span class="dt">task =</span> task_nsp,
                        <span class="dt">resampling =</span> resampling_nsp,
                        <span class="dt">measures =</span> mlr<span class="op">::</span>auc)
<span class="co"># Visualization of non-spatial overfitting</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/boxplot">boxplot</a></span>(sp_cv<span class="op">$</span>measures.test<span class="op">$</span>auc,
        conv_cv<span class="op">$</span>measures.test<span class="op">$</span>auc, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"lightblue2"</span>, <span class="st">"mistyrose2"</span>),
        <span class="dt">names =</span> <span class="kw">c</span>(<span class="st">"spatial CV"</span>, <span class="st">"conventional CV"</span>), <span class="dt">ylab =</span> <span class="st">"AUROC"</span>)</code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Model landslide susceptibility using a quadratic discriminant analysis (QDA). Assess the predictive performance of the QDA. What is the a difference between the spatially cross-validated mean AUROC value of the QDA and the GLM? Hint: Before running the spatial cross-validation for both learners set a seed to make sure that both use the same partitions which in turn guarantees comparability.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># attach packages</span>
<span class="kw">library</span>(mlr)
<span class="co"># attach data (in case you have not computed the terrain attributes before)</span>
<span class="kw">load</span>(<span class="st">"extdata/spatialcv.Rdata"</span>)

<span class="co"># put the coordinates in an additional dataframe</span>
coords =<span class="st"> </span>lsl[, <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]
data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(lsl, <span class="op">-</span>x, <span class="op">-</span>y)
<span class="co"># data_nonspatial = dplyr::select(data, -x, -y)</span>

<span class="co"># CREATE TASKS</span>
<span class="co">#*************</span>

<span class="co"># spatial task</span>
task =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/Task">makeClassifTask</a></span>(<span class="dt">data =</span> data, <span class="dt">target =</span> <span class="st">"lslpts"</span>, 
                       <span class="dt">positive =</span> <span class="st">"TRUE"</span>, <span class="dt">coordinates =</span> coords)

<span class="co"># CONSTRUCT LEARNER</span>
<span class="co">#******************</span>

lrn_glm =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"classif.binomial"</span>,
                      <span class="dt">link =</span> <span class="st">"logit"</span>,
                      <span class="dt">predict.type =</span> <span class="st">"prob"</span>)
lrn_qda =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"classif.qda"</span>,
                      <span class="dt">predict.type =</span> <span class="st">"prob"</span>)

<span class="co"># find out about the models to be fitted</span>
<span class="co"># getTaskFormula(task)</span>
<span class="co"># train(learner = lrn_glm, task = task)</span>
<span class="co"># getLearnerModel(train(learner = lrn_glm, task = task))</span>
<span class="co"># train(learner = lrn_qda, task = task)</span>
<span class="co"># getLearnerModel(train(learner = lrn_qda, task = task))</span>

<span class="co"># DEFINE RESAMPLING STRATEGY</span>
<span class="co">#***************************</span>

<span class="co"># 100-repeated 5-fold spatial resampling strategy</span>
resampling =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeResampleDesc">makeResampleDesc</a></span>(<span class="dt">method =</span> <span class="st">"SpRepCV"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">100</span>)

<span class="co"># (SPATIAL) CROSS-VALIDATAION</span>
<span class="co">#****************************</span>

<span class="co"># set a seed to make sure that the same partitions are used for GLM and QDA</span>
<span class="kw">set.seed</span>(<span class="dv">012349</span>)
<span class="co"># execute the resampling</span>
sp_glm =<span class="st"> </span>mlr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/resample">resample</a></span>(<span class="dt">learner =</span> lrn_glm, <span class="dt">task =</span> task,
                       <span class="dt">resampling =</span> resampling,
                       <span class="dt">measures =</span> mlr<span class="op">::</span>auc)
sp_qda =<span class="st"> </span>mlr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/resample">resample</a></span>(<span class="dt">learner =</span> lrn_qda, <span class="dt">task =</span> task_nsp,
                       <span class="dt">resampling =</span> resampling_nsp,
                       <span class="dt">measures =</span> mlr<span class="op">::</span>auc)
<span class="co"># QDA has higher AUROC values on average which indicates moderately non-linear</span>
<span class="co"># boundaries</span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/raster/topics/boxplot">boxplot</a></span>(sp_glm<span class="op">$</span>measures.test<span class="op">$</span>auc,
        sp_qda<span class="op">$</span>measures.test<span class="op">$</span>auc, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">"lightblue2"</span>, <span class="st">"mistyrose2"</span>),
        <span class="dt">names =</span> <span class="kw">c</span>(<span class="st">"GLM"</span>, <span class="st">"QDA"</span>), <span class="dt">ylab =</span> <span class="st">"AUROC"</span>)</code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Run the SVM without tuning the hyperparameters. Use the <code>rbfdot</code> kernel with <span class="math inline">\(\sigma\)</span> = 1 and <em>C</em> = 1. Leaving the hyperparameters unspecified in <strong>kernlab</strong>’s <code>ksvm()</code> would otherwise initialize an automatic non-spatial hyperparameter tuning.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># attach packages</span>
<span class="kw">library</span>(mlr)
<span class="co"># attach data (in case you have not computed the terrain attributes before)</span>
<span class="kw">load</span>(<span class="st">"extdata/spatialcv.Rdata"</span>)

<span class="co"># put the coordinates in an additional dataframe</span>
coords =<span class="st"> </span>lsl[, <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]
data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(lsl, <span class="op">-</span>x, <span class="op">-</span>y)
<span class="co"># data_nonspatial = dplyr::select(data, -x, -y)</span>

<span class="co"># CREATE </span><span class="al">TASK</span>
<span class="co">#*************</span>

<span class="co"># spatial task</span>
task =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/Task">makeClassifTask</a></span>(<span class="dt">data =</span> data, <span class="dt">target =</span> <span class="st">"lslpts"</span>, 
                       <span class="dt">positive =</span> <span class="st">"TRUE"</span>, <span class="dt">coordinates =</span> coords)


<span class="co"># CONSTRUCT LEARNER</span>
<span class="co">#******************</span>
lrn_ksvm =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="st">"classif.ksvm"</span>,
                       <span class="dt">predict.type =</span> <span class="st">"prob"</span>,
                       <span class="dt">kernel =</span> <span class="st">"rbfdot"</span>,
                       <span class="dt">C =</span> <span class="dv">1</span>,
                       <span class="dt">sigma =</span> <span class="dv">1</span>)

<span class="co"># RESAMPLING</span>
<span class="co">#***********</span>
<span class="co"># 100-repeated 5-fold spatial cross-validation without any hyperparameter </span>
<span class="co"># tuning</span>
resampling =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeResampleDesc">makeResampleDesc</a></span>(<span class="st">"SpRepCV"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">100</span>)

<span class="co"># parallel processing not really necessary (only 500 models)</span>
<span class="co"># library(parallelMap)</span>
<span class="co"># parallelStart(mode = "multicore", level = "mlr.resample", </span>
<span class="co">#               cpus = parallel::detectCores() / 2)</span>

<span class="kw">set.seed</span>(<span class="dv">28032018</span>)
resa_svm_spatial =<span class="st"> </span>mlr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/resample">resample</a></span>(<span class="dt">learner =</span> lrn_ksvm, 
                                 <span class="dt">task =</span> task,
                                 <span class="dt">resampling =</span> resampling,
                                 <span class="dt">measures =</span> mlr<span class="op">::</span>auc,
                                 <span class="dt">show.info =</span> <span class="ot">TRUE</span>)
<span class="co"># Aggregated Result: auc.test.mean=0.7843021</span>
<span class="co"># parallelStop()</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Model landslide susceptibility with the help of <strong>mlr</strong> using a random forest model as implemented by the <strong>ranger</strong> package. Apply a nested spatial CV. Parallelize the tuning level. Use a random search with 50 iterations to find the optimal hyperparameter combination (here: <code>mtry</code> and <code>num.trees</code>). The tuning space limits are 1 and 4 for <code>mtry</code>, and 1 and 10,000 for <code>num.trees</code>. Warning: This might take a long time. More cores substantially decrease computing time.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># attach packages</span>
<span class="kw">library</span>(mlr)
<span class="co"># attach data (in case you have not computed the terrain attributes before)</span>
<span class="kw">load</span>(<span class="st">"extdata/spatialcv.Rdata"</span>)

<span class="co"># put the coordinates in an additional dataframe</span>
coords =<span class="st"> </span>lsl[, <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)]
data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/select.html">select</a></span>(lsl, <span class="op">-</span>x, <span class="op">-</span>y)
<span class="co"># data_nonspatial = dplyr::select(data, -x, -y)</span>

<span class="co"># CREATE TASKS</span>
<span class="co">#*************</span>

<span class="co"># spatial task</span>
task =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/Task">makeClassifTask</a></span>(<span class="dt">data =</span> data, <span class="dt">target =</span> <span class="st">"lslpts"</span>, 
                       <span class="dt">positive =</span> <span class="st">"TRUE"</span>, <span class="dt">coordinates =</span> coords)

<span class="co"># CONSTRUCT LEARNER</span>
<span class="co">#******************</span>
<span class="co"># possibly you have to run:</span>
<span class="co"># install.packages("ranger")</span>
lrns =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/listLearners">listLearners</a></span>(task)
<span class="co"># look for the ranger package</span>
dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(lrns, package <span class="op">%in%</span><span class="st"> "ranger"</span>)
<span class="co"># use random forest as implemented in the ranger package</span>
lrn_rf =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeLearner">makeLearner</a></span>(<span class="dt">cl =</span> <span class="st">"classif.ranger"</span>,
                     <span class="dt">predict.type =</span> <span class="st">"prob"</span>)

<span class="co"># RESAMPLING</span>
<span class="co">#***********</span>

<span class="co"># Outer resampling loop</span>
outer =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeResampleDesc">makeResampleDesc</a></span>(<span class="st">"SpRepCV"</span>, <span class="dt">folds =</span> <span class="dv">5</span>, <span class="dt">reps =</span> <span class="dv">100</span>)
<span class="co"># Tuning of hyperparameters in inner resampling loop using a random search with</span>
<span class="co"># 50 iterations</span>
ctrl =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeTuneControlRandom">makeTuneControlRandom</a></span>(<span class="dt">maxit =</span> <span class="dv">50</span>)
inner =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeResampleDesc">makeResampleDesc</a></span>(<span class="st">"SpCV"</span>, <span class="dt">iters =</span> <span class="dv">5</span>)
ps =<span class="st"> </span><span class="kw">makeParamSet</span>(<span class="kw">makeIntegerParam</span>(<span class="st">"mtry"</span>, <span class="dt">lower =</span> <span class="dv">1</span>, <span class="dt">upper =</span> <span class="dv">11</span>),
                  <span class="kw">makeIntegerParam</span>(<span class="st">"num.trees"</span>, <span class="dt">lower =</span> <span class="dv">10</span>, <span class="dt">upper =</span> <span class="dv">10000</span>))
<span class="co"># wrap the learner</span>
wrapped_lrn_rf =<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/makeTuneWrapper">makeTuneWrapper</a></span>(<span class="dt">learner =</span> lrn_rf,
                                 <span class="dt">resampling =</span> inner,
                                 <span class="dt">par.set =</span> ps,
                                 <span class="dt">control =</span> ctrl,
                                 <span class="dt">measures =</span> mlr<span class="op">::</span>auc,
                                 <span class="dt">show.info =</span> <span class="ot">TRUE</span>)

<span class="co"># parallelization</span>
<span class="kw">library</span>(parallelMap)

<span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/configureMlr">configureMlr</a></span>(<span class="dt">on.learner.error =</span> <span class="st">"warn"</span>, <span class="dt">on.error.dump =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/parallelMap/topics/parallelStart">parallelStart</a></span>(<span class="dt">mode =</span> <span class="st">"multicore"</span>, 
              <span class="co"># only parallelize the tuning</span>
              <span class="dt">level =</span> <span class="st">"mlr.tuneParams"</span>, 
              <span class="dt">cpus =</span> <span class="kw">round</span>(parallel<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/detectCores">detectCores</a></span>() <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),
              <span class="dt">mc.set.seed =</span> <span class="ot">TRUE</span>) 

<span class="kw">set.seed</span>(<span class="dv">280320181</span>)
resa_rf_spatial =<span class="st"> </span>mlr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/mlr/topics/resample">resample</a></span>(<span class="dt">learner =</span> wrapped_lrn_rf,
                                <span class="dt">task =</span> task,
                                <span class="dt">resampling =</span> outer,
                                <span class="dt">extract =</span> getTuneResult,
                                <span class="dt">measures =</span> mlr<span class="op">::</span>auc,
                                <span class="dt">show.info =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/parallelMap/topics/parallelStop">parallelStop</a></span>()</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#chapter-1">Chapter 1</a></li>
      <li><a href="#chapter-2">Chapter 2</a></li>
      <li><a href="#chapter-3">Chapter 3</a></li>
      <li><a href="#chapter-4">Chapter 4</a></li>
      <li><a href="#chapter-5">Chapter 5</a></li>
      <li><a href="#chapter-8-location-analysis">Chapter 8 Location analysis</a></li>
      <li><a href="#chapter-r-gis-bridges">Chapter R-GIS bridges</a></li>
      <li><a href="#chapter-spatial-cross-validation">Chapter Spatial cross-validation</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robin Lovelace, Jakub Nowosad, Jannes Muenchow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
