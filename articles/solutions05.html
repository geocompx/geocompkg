<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chapter 5: Geometric operations • geocompkg | metapackage for the book Gecomputation with R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 5: Geometric operations">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocompkg | metapackage for the book Gecomputation with R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.75</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://geocompr.github.io/">Home</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/geocompr/geocompkg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Chapter 5: Geometric operations</h1>
                        <h4 class="author">Robin Lovelace, Jakub Nowosad, Jannes Muenchow</h4>
            
            <h4 class="date">2019-03-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/geocompr/geocompkg/blob/master/vignettes/solutions05.Rmd"><code>vignettes/solutions05.Rmd</code></a></small>
      <div class="hidden name"><code>solutions05.Rmd</code></div>

    </div>

    
    
<div id="prerequisites" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>The solutions assume the following packages are attached (other packages will be attached when needed):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(raster)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(spData)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(spDataLarge)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(RQGIS)</code></pre></div>
<p>Some of the exercises use a vector (<code>random_points</code>) and raster dataset (<code>ndvi</code>) from the <strong>RQGIS</strong> package. They also use a polygonal ‘convex hull’ derived from the vector dataset (<code>ch</code>) to represent the area of interest:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(random_points)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(ndvi)
ch =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_combine">st_combine</a></span>(random_points) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_convex_hull</a></span>()</code></pre></div>
</div>
<div id="chapter-5" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-5" class="anchor"></a>Chapter 5</h1>
<ol style="list-style-type: decimal">
<li>Generate and plot simplified versions of the <code>nz</code> dataset. Experiment with different values of <code>keep</code> (ranging from 0.5 to 0.00005) for <code>ms_simplify()</code> and <code>dTolerance</code> (from 100 to 100,000) <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify()</a></code> .
<ul>
<li>At what value does the form of the result start to break-down for each method, making New Zealand unrecognizable?</li>
<li>Advanced: What is different about the geometry type of the results from <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify()</a></code> compared with the geometry type of <code>ms_simplify()</code>? What problems does this create and how can this be resolved?</li>
</ul>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(rmapshaper<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rmapshaper/topics/ms_simplify">ms_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">keep =</span> <span class="fl">0.5</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(rmapshaper<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rmapshaper/topics/ms_simplify">ms_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">keep =</span> <span class="fl">0.05</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Starts to breakdown here at 0.5% of the points:</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(rmapshaper<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rmapshaper/topics/ms_simplify">ms_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">keep =</span> <span class="fl">0.005</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-3.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># At this point no further simplification changes the result</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(rmapshaper<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rmapshaper/topics/ms_simplify">ms_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">keep =</span> <span class="fl">0.0005</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(rmapshaper<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/rmapshaper/topics/ms_simplify">ms_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">keep =</span> <span class="fl">0.00005</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-4.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">dTolerance =</span> <span class="dv">100</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-5.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">dTolerance =</span> <span class="dv">1000</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-6.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Starts to breakdown at 10 km:</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">dTolerance =</span> <span class="dv">10000</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-7.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">dTolerance =</span> <span class="dv">100000</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-8.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">dTolerance =</span> <span class="dv">100000</span>, <span class="dt">preserveTopology =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-9.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># Problem: st_simplify returns POLYGON and MULTIPOLYGON results, affecting plotting</span>
<span class="co"># Cast into a single geometry type to resolve this</span>
nz_simple_poly =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">dTolerance =</span> <span class="dv">10000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_cast">st_cast</a></span>(<span class="st">"POLYGON"</span>)
<span class="co">#&gt; Warning in st_cast.MULTIPOLYGON(X[[i]], ...): polygon from first part only</span>

<span class="co">#&gt; Warning in st_cast.MULTIPOLYGON(X[[i]], ...): polygon from first part only</span>
nz_simple_multipoly =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_simplify</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz), <span class="dt">dTolerance =</span> <span class="dv">10000</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_cast">st_cast</a></span>(<span class="st">"MULTIPOLYGON"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(nz_simple_poly)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-2-10.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(nz_simple_poly)
<span class="co">#&gt; [1] 16</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(nz)
<span class="co">#&gt; [1] 16</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>In the first exercise in this <a href="https://geocompr.robinlovelace.net/spatial-data-operations.html">Chapter</a> it was established that Canterbury region had 70 of the 101 highest points in New Zealand. Using <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_buffer()</a></code>, how many points in <code>nz_height</code> are within 100 km of Canterbury?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">canterbury =<span class="st"> </span>nz[nz<span class="op">$</span>Name <span class="op">==</span><span class="st"> "Canterbury"</span>, ]
cant_buff =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_buffer</a></span>(canterbury, <span class="dv">100</span>)
nz_height_near_cant =<span class="st"> </span>nz_height[cant_buff, ]
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/ncell">nrow</a></span>(nz_height_near_cant) <span class="co"># 75 - 5 more</span>
<span class="co">#&gt; [1] 75</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Find the geographic centroid of New Zealand. How far is it from the geographic centroid of Canterbury?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cant_cent =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_centroid</a></span>(canterbury)
<span class="co">#&gt; Warning in st_centroid.sf(canterbury): st_centroid assumes attributes are</span>
<span class="co">#&gt; constant over geometries of x</span>
nz_centre =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_centroid</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_combine">st_union</a></span>(nz))
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_measures">st_distance</a></span>(cant_cent, nz_centre) <span class="co"># 234 km</span>
<span class="co">#&gt; Units: [m]</span>
<span class="co">#&gt;          [,1]</span>
<span class="co">#&gt; [1,] 234192.6</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Most world maps have a north-up orientation. A world map with a south-up orientation could be created by a reflection (one of the affine transformations not mentioned in this <a href="https://geocompr.robinlovelace.net/geometric-operations.html#affine-transformations">section</a>) of the <code>world</code> object’s geometry. Write code to do so. Hint: you need to use a two-element vector for this transformation.
<ul>
<li>Bonus: create a upside down map of your country.</li>
</ul>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">world_sfc =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(world)
world_sfc_mirror =<span class="st"> </span>world_sfc <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)
<span class="co">#&gt; Warning in mapply(function(x, y) {: longer argument not a multiple of</span>
<span class="co">#&gt; length of shorter</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(world_sfc)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(world_sfc_mirror)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-5-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
us_states_sfc =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(us_states)
us_states_sfc_mirror =<span class="st"> </span>us_states_sfc <span class="op">*</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>)
<span class="co">#&gt; Warning in mapply(function(x, y) {: longer argument not a multiple of</span>
<span class="co">#&gt; length of shorter</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(us_states_sfc)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-5-3.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(us_states_sfc_mirror)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-5-4.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## nicer plot
<span class="co"># library(ggrepel)</span>
<span class="co"># us_states_sfc_mirror_labels = st_centroid(us_states_sfc_mirror) %&gt;% </span>
<span class="co">#   st_coordinates() %&gt;%</span>
<span class="co">#   as_data_frame() %&gt;% </span>
<span class="co">#   mutate(name = us_states$NAME)</span>
<span class="co"># us_states_sfc_mirror_sf = st_set_geometry(us_states, us_states_sfc_mirror)</span>
<span class="co"># ggplot(data = us_states_sfc_mirror_sf) +</span>
<span class="co">#   geom_sf(color = "white") +</span>
<span class="co">#   geom_text_repel(data = us_states_sfc_mirror_labels, mapping = aes(X, Y, label = name), size = 3, min.segment.length = 0) +</span>
<span class="co">#   theme_void() </span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Subset the point in <code>p</code> that is contained within <code>x</code> <em>and</em> <code>y</code> (see this <a href="https://geocompr.robinlovelace.net/geometric-operations.html#clipping">section</a> and this <a href="https://geocompr.robinlovelace.net/geometric-operations.html#fig:venn-clip">Figure</a>).
<ul>
<li>Using base subsetting operators.</li>
<li>Using an intermediary object created with <code><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_ops">st_intersection()</a></code>.</li>
</ul>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># data preparation</span>
b =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/sfc">st_sfc</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_point</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">0</span>, <span class="dv">1</span>)), <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_point</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>))) <span class="co"># create 2 points</span>
b =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_buffer</a></span>(b, <span class="dt">dist =</span> <span class="dv">1</span>) <span class="co"># convert points to circles</span>
x =<span class="st"> </span>b[<span class="dv">1</span>]
y =<span class="st"> </span>b[<span class="dv">2</span>]
bb =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_bbox">st_bbox</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_combine">st_union</a></span>(x, y))
pmat =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/matrix">matrix</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(bb[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>)]), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">byrow =</span> <span class="ot">TRUE</span>)
box =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st">st_polygon</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(pmat))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">2017</span>)
p =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_sample">st_sample</a></span>(<span class="dt">x =</span> box, <span class="dt">size =</span> <span class="dv">10</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p_in_y =<span class="st"> </span>p[y]
p_in_xy =<span class="st"> </span>p_in_y[x]
x_and_y =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_binary_ops">st_intersection</a></span>(x, y)
p[x_and_y]
<span class="co">#&gt; Geometry set for 1 feature </span>
<span class="co">#&gt; geometry type:  POINT</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 0.3047168 ymin: 1.431415 xmax: 0.3047168 ymax: 1.431415</span>
<span class="co">#&gt; epsg (SRID):    NA</span>
<span class="co">#&gt; proj4string:    NA</span>
<span class="co">#&gt; POINT (0.3047168 1.431415)</span></code></pre></div>
<ol start="6" style="list-style-type: decimal">
<li>Calculate the length of the boundary lines of US states in meters. Which state has the longest border and which has the shortest? Hint: The <code>st_length</code> function computes the length of a <code>LINESTRING</code> or <code>MULTILINESTRING</code> geometry.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">us_states2163 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(us_states, <span class="dv">2163</span>)
us_states_bor =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_cast">st_cast</a></span>(us_states2163, <span class="st">"MULTILINESTRING"</span>)
us_states_bor<span class="op">$</span>borders =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_measures">st_length</a></span>(us_states_bor)
<span class="kw">arrange</span>(us_states_bor, borders) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span>)
<span class="co">#&gt; Simple feature collection with 1 feature and 7 fields</span>
<span class="co">#&gt; geometry type:  MULTILINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: 1950825 ymin: -415971.5 xmax: 1969385 ymax: -393947.3</span>
<span class="co">#&gt; epsg (SRID):    2163</span>
<span class="co">#&gt; proj4string:    +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs</span>
<span class="co">#&gt;   GEOID                 NAME REGION          AREA total_pop_10</span>
<span class="co">#&gt; 1    11 District of Columbia  South 178.21 [km^2]       584400</span>
<span class="co">#&gt;   total_pop_15      borders                       geometry</span>
<span class="co">#&gt; 1       647484 60322.91 [m] MULTILINESTRING ((1950825 -...</span>
<span class="kw">arrange</span>(us_states_bor, <span class="op">-</span>borders) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span>)
<span class="co">#&gt; Simple feature collection with 1 feature and 7 fields</span>
<span class="co">#&gt; geometry type:  MULTILINESTRING</span>
<span class="co">#&gt; dimension:      XY</span>
<span class="co">#&gt; bbox:           xmin: -630041.5 ymin: -2116610 xmax: 621671.6 ymax: -939313.8</span>
<span class="co">#&gt; epsg (SRID):    2163</span>
<span class="co">#&gt; proj4string:    +proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs</span>
<span class="co">#&gt;   GEOID  NAME REGION            AREA total_pop_10 total_pop_15     borders</span>
<span class="co">#&gt; 1    48 Texas  South 687714.3 [km^2]     24311891     26538614 4961585 [m]</span>
<span class="co">#&gt;                         geometry</span>
<span class="co">#&gt; 1 MULTILINESTRING ((-269040 -...</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>Crop the <code>ndvi</code> raster using (1) the <code>random_points</code> dataset and (2) the <code>ch</code> dataset. Are there any difference in the output maps? Next, mask <code>ndvi</code> using these two datasets. Can you see any difference now? How can you explain that?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ndvi)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(random_points), <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ch, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
ndvi_crop1 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/crop">crop</a></span>(ndvi, <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(random_points, <span class="st">"Spatial"</span>)) 
ndvi_crop2 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/crop">crop</a></span>(ndvi, <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(ch, <span class="st">"Spatial"</span>)) 
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ndvi_crop1)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ndvi_crop2)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-9-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
ndvi_mask1 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(ndvi, <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(random_points, <span class="st">"Spatial"</span>)) 
ndvi_mask2 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/mask">mask</a></span>(ndvi, <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(ch, <span class="st">"Spatial"</span>)) 
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ndvi_mask1)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-9-3.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ndvi_mask2)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-9-4.png" width="700"></p>
<p>There are not any differences between the two output maps after cropping, but the outputs after masking are very different. In the first case, <code>ndvi</code> is cropped only to the extent of the bounding box, and both <code>random_points</code> and <code>ch</code> have exactly the same bounding box. In the second case, masking by <code>random_points</code> only keeps raster cells that are overlayed by these points, while masking by <code>ch</code> keeps all raster cells that are within the <code>ch</code> polygon.</p>
<ol start="8" style="list-style-type: decimal">
<li>Firstly, extract values from <code>ndvi</code> at the points represented in <code>random_points</code>. Next, extract average values of <code>ndvi</code> using a 90 buffer around each point from <code>random_points</code> and compare these two sets of values. When would extracting values by buffers be more suitable than by points alone?</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">random_points_buf =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/geos_unary">st_buffer</a></span>(random_points, <span class="dt">dist =</span> <span class="dv">90</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ndvi)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(random_points_buf), <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(ch, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">random_points<span class="op">$</span>ndvi1 =<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/extract">extract</a></span>(ndvi, <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(random_points, <span class="st">"Spatial"</span>))
random_points<span class="op">$</span>ndvi2 =<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/extract">extract</a></span>(ndvi, <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/coerce-methods">as</a></span>(random_points, <span class="st">"Spatial"</span>), <span class="dt">buffer =</span> <span class="dv">90</span>, <span class="dt">fun =</span> mean)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(random_points<span class="op">$</span>ndvi1, random_points<span class="op">$</span>ndvi2)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
<p>Extracting values by buffers is more suitable than by points alone, for example when we expect errors in single raster cells. Average values can decrease an effect of erroneous values in some raster cells.</p>
<ol start="9" style="list-style-type: decimal">
<li>Subset points higher than 3100 meters in New Zealand (the <code>nz_height</code> object) and create a template raster with a resolution of 3km. Using these objects:
<ul>
<li>Count numbers of the highest points in each grid cell.</li>
<li>Find the maximum elevation in each grid cell.</li>
</ul>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_height3100 =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(nz_height, elevation <span class="op">&gt;</span><span class="st"> </span><span class="dv">3100</span>)
new_graticule =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_graticule">st_graticule</a></span>(nz_height3100, <span class="dt">datum =</span> <span class="dv">2193</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_geometry">st_geometry</a></span>(nz_height3100), <span class="dt">graticule =</span> new_graticule, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_template =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/raster">raster</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/extent">extent</a></span>(nz_height3100), <span class="dt">resolution =</span> <span class="dv">3000</span>,
                         <span class="dt">crs =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_crs">st_crs</a></span>(nz_height3100)<span class="op">$</span>proj4string)
nz_raster =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterize">rasterize</a></span>(nz_height3100, nz_template, 
                       <span class="dt">field =</span> <span class="st">"elevation"</span>, <span class="dt">fun =</span> <span class="st">"count"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(nz_raster)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_raster2 =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterize">rasterize</a></span>(nz_height3100, nz_template, 
                       <span class="dt">field =</span> <span class="st">"elevation"</span>, <span class="dt">fun =</span> max)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(nz_raster2)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-11-3.png" width="700"></p>
<ol start="10" style="list-style-type: decimal">
<li>Aggregate the raster counting high points in New Zealand (created in the previous exercise), reduce its geographic resolution by half (so cells are 6 by 6 km) and plot the result.
<ul>
<li>Resample the lower resolution raster back to a resolution of 3 km. How have the results changed?</li>
<li>Name two advantages and disadvantages of reducing raster resolution.</li>
</ul>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nz_raster_low =<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/aggregate">aggregate</a></span>(nz_raster, <span class="dt">fact =</span> <span class="dv">2</span>, <span class="dt">fun =</span> sum)
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/resolution">res</a></span>(nz_raster_low)
nz_resample =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/resample">resample</a></span>(nz_raster_low, nz_raster)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(nz_raster_low)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(nz_resample) <span class="co"># the results are spread over a greater area and there are border issues</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(nz_raster)</code></pre></div>
<p>advantage: lower memory use advantage: faster processing advantage: good for viz in some cases disadvantage: removes geographic detail disadvantage: another processing step</p>
<ol start="11" style="list-style-type: decimal">
<li>Polygonize the <code>grain</code> dataset and filter all squares representing clay.
<ul>
<li>Name two advantages and disadvantages of vector data over raster data.</li>
<li>At which points would it be useful to convert rasters to vectors in your work?</li>
</ul>
</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">grain_poly =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/rasterToPolygons">rasterToPolygons</a></span>(grain) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>()
<span class="kw"><a href="https://www.rdocumentation.org/packages/raster/topics/factor">levels</a></span>(grain)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt;   ID VALUE</span>
<span class="co">#&gt; 1  1  clay</span>
<span class="co">#&gt; 2  2  silt</span>
<span class="co">#&gt; 3  3  sand</span>
clay =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(grain_poly, layer <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(clay)</code></pre></div>
<p><img src="solutions05_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>advantages: - can be used to subset other vector objects - can do affine transformations and use sf/dplyr verbs disadvantages: - better consistency, fast processing on some operations, functions developed for some domains</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#chapter-5">Chapter 5</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Robin Lovelace, Jakub Nowosad, Jannes Muenchow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
