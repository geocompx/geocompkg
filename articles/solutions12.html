<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chapter 12: Transportation • geocompkg | metapackage for the Gecomputation with R book</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Chapter 12: Transportation">
<meta property="og:description" content="geocompkg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">geocompkg | metapackage for the Gecomputation with R book</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.102</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="https://geocompr.github.io/vignettes/">Vignettes and solutions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://geocompr.github.io/">Back to the main website</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="solutions12_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Chapter 12: Transportation</h1>
                        <h4 class="author">Robin Lovelace, Jakub Nowosad, Jannes Muenchow</h4>
            
            <h4 class="date">2020-07-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Robinlovelace/geocompr/blob/master/vignettes/solutions12.Rmd"><code>vignettes/solutions12.Rmd</code></a></small>
      <div class="hidden name"><code>solutions12.Rmd</code></div>

    </div>

    
    
<div id="prerequisites" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>The solutions assume the following packages are attached (other packages will be attached when needed):</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://r-spatial.github.io/sf">sf</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org">dplyr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/Nowosad/spData">spDataLarge</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://docs.ropensci.org/stplanr">stplanr</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://github.com/mtennekes/tmap">tmap</a></span>) 
</pre></div>
<p>You must have run the following code chunks to answer the questions:</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">zones_attr</span> <span class="op">=</span> <span class="kw">bristol_od</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">o</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_if</a></span>(<span class="kw">is.numeric</span>, <span class="kw">sum</span>) <span class="op">%&gt;%</span> 
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span>(geo_code = <span class="kw">o</span>)

<span class="kw">zones_joined</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="kw">bristol_zones</span>, <span class="kw">zones_attr</span>, by = <span class="st">"geo_code"</span>)

<span class="kw">zones_od</span> <span class="op">=</span> <span class="kw">bristol_od</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="kw">d</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html">summarize_if</a></span>(<span class="kw">is.numeric</span>, <span class="kw">sum</span>) <span class="op">%&gt;%</span> 
  <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(geo_code = <span class="kw">d</span>, all_dest = <span class="kw">all</span>) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">inner_join</a></span>(<span class="kw">zones_joined</span>, <span class="kw">.</span>, by = <span class="st">"geo_code"</span>)

<span class="kw">od_top5</span> <span class="op">=</span> <span class="kw">bristol_od</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(<span class="fu"><a href="https://dplyr.tidyverse.org/reference/desc.html">desc</a></span>(<span class="kw">all</span>)) <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="fl">5</span>, wt = <span class="kw">all</span>)

<span class="kw">bristol_od</span><span class="op">$</span><span class="kw">Active</span> <span class="op">=</span> (<span class="kw">bristol_od</span><span class="op">$</span><span class="kw">bicycle</span> <span class="op">+</span> <span class="kw">bristol_od</span><span class="op">$</span><span class="kw">foot</span>) <span class="op">/</span>
  <span class="kw">bristol_od</span><span class="op">$</span><span class="kw">all</span> <span class="op">*</span> <span class="fl">100</span>

<span class="kw">od_intra</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">bristol_od</span>, <span class="kw">o</span> <span class="op">==</span> <span class="kw">d</span>)
<span class="kw">od_inter</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">bristol_od</span>, <span class="kw">o</span> != <span class="kw">d</span>)

<span class="kw">desire_lines</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/od2line.html">od2line</a></span>(<span class="kw">od_inter</span>, <span class="kw">zones_od</span>)
<span class="co">#&gt; Creating centroids representing desire line start and end points.</span>

<span class="kw">desire_lines</span><span class="op">$</span><span class="kw">distance</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_length</a></span>(<span class="kw">desire_lines</span>))
<span class="kw">desire_carshort</span> <span class="op">=</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">desire_lines</span>, <span class="kw">car_driver</span> <span class="op">&gt;</span> <span class="fl">300</span> <span class="op">&amp;</span> <span class="kw">distance</span> <span class="op">&lt;</span> <span class="fl">5000</span>)
<span class="kw">desire_carshort</span><span class="op">$</span><span class="kw">geom_car</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/sf/man/st_geometry.html">st_geometry</a></span>(<span class="kw">route_carshort</span>)

<span class="kw">desire_rail</span> <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="kw">desire_lines</span>, n = <span class="fl">3</span>, wt = <span class="kw">train</span>)
<span class="kw">desire_rail</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/line_via.html">line_via</a></span>(<span class="kw">desire_rail</span>, <span class="kw">bristol_stations</span>)

<span class="kw">ways_freeway</span> <span class="op">=</span> <span class="kw">bristol_ways</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">maxspeed</span> <span class="op">==</span> <span class="st">"70 mph"</span>) 
<span class="kw">ways_sln</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/SpatialLinesNetwork.html">SpatialLinesNetwork</a></span>(<span class="kw">ways_freeway</span>)
<span class="co">#&gt; Warning in SpatialLinesNetwork.sf(ways_freeway): Graph composed of multiple</span>
<span class="co">#&gt; subgraphs, consider cleaning it with sln_clean_graph().</span>

<span class="kw">route_cycleway</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw">route_rail</span>, <span class="kw">route_carshort</span>)
<span class="kw">route_cycleway</span><span class="op">$</span><span class="kw">all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">desire_rail</span><span class="op">$</span><span class="kw">all</span>, <span class="kw">desire_carshort</span><span class="op">$</span><span class="kw">all</span>)
</pre></div>
</div>
<div id="chapter-12" class="section level1">
<h1 class="hasAnchor">
<a href="#chapter-12" class="anchor"></a>Chapter 12</h1>
<ol style="list-style-type: decimal">
<li>What is the total distance of cycleways that would be constructed if all the routes presented in this <a href="https://geocompr.robinlovelace.net/transport.html#fig:cycleways">Figure</a> were to be constructed?
<ul>
<li>Bonus: find two ways of arriving at the same answer.</li>
</ul>
</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">route_cycleway</span><span class="op">$</span><span class="kw">distance</span>)
<span class="co">#&gt; [1] 41996.8</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/sf/man/geos_measures.html">st_length</a></span>(<span class="kw">route_cycleway</span>))
<span class="co">#&gt; 42077.53 [m]</span>
</pre></div>
<ol start="2" style="list-style-type: decimal">
<li>What proportion of trips represented in the <code>desire_lines</code> are accounted for in the <code>route_cycleway</code> object?
<ul>
<li>Bonus: what proportion of trips cross the proposed routes?</li>
<li>Advanced: write code that would increase this proportion.</li>
</ul>
</li>
</ol>
<p>To increase the proportion of trips that cross the proposed route, you could reduce the threshold for the number of cars in the ‘carshort’ object, e.g., by reducing the <code>car_driver</code> threshold to 200 as follows (code not run to avoid over-loading the OSRM demo server):</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">desire_carshort2</span> <span class="op">=</span> <span class="kw">dplyr</span>::<span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="kw">desire_lines</span>, <span class="kw">car_driver</span> <span class="op">&gt;</span> <span class="fl">200</span> <span class="op">&amp;</span> <span class="kw">distance</span> <span class="op">&lt;</span> <span class="fl">5000</span>)
<span class="kw">route_carshort2</span> <span class="op">=</span> <span class="fu"><a href="https://docs.ropensci.org/stplanr/reference/line2route.html">line2route</a></span>(<span class="kw">desire_carshort2</span>, route_fun = <span class="kw">route_osrm</span>) 
<span class="kw">route_cycleway2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="kw">route_rail</span>, <span class="kw">route_carshort2</span>)
<span class="kw">route_cycleway2</span><span class="op">$</span><span class="kw">all</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">desire_rail</span><span class="op">$</span><span class="kw">all</span>, <span class="kw">desire_carshort2</span><span class="op">$</span><span class="kw">all</span>)

<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">route_cycleway2</span><span class="op">$</span><span class="kw">all</span>) <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">desire_lines</span><span class="op">$</span><span class="kw">all</span>) <span class="co"># around 7%</span>
<span class="kw">d_intersect</span> <span class="op">=</span> <span class="kw">desire_lines</span>[<span class="kw">route_cycleway2</span>, , op = <span class="kw">st_crosses</span>]
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">d_intersect</span><span class="op">$</span><span class="kw">all</span>) <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw">desire_lines</span><span class="op">$</span><span class="kw">all</span>) <span class="co"># around 62%</span>
</pre></div>
<ol start="3" style="list-style-type: decimal">
<li>The analysis presented in this chapter is designed for teaching how geocomputation methods can be applied to transport research. If you were to do this ‘for real’ for local government or a transport consultancy what top 3 things would you do differently?</li>
</ol>
<p>Answers:</p>
<ul>
<li>Higher level of geographic resolution.</li>
<li>Use cycle-specific routing services.</li>
<li>Identify key walking routes.</li>
<li>Include a higher proportion of trips in the analysis.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Clearly the routes identified in this <a href="https://geocompr.robinlovelace.net/transport.html#fig:cycleways">Figure</a> only provide part of the picture. How would you extend the analysis to incorporate more trips that could potentially be cycled?</li>
</ol>
<p>There are many ways to extend the analysis. Some promising lines of research could include:</p>
<ul>
<li>Prioritising areas that already have high cycling levels, to get maximium ‘positive feedback’ loops. This may be a sensible near-term strategy.</li>
<li>Identify datasets representing, or model, other trip purposes to identify where most short trips are taking place. Spatial interaction models could help here.</li>
<li>Identify ‘near market’ populations who are most willing to switch using techniques covered in Chapter <a href="https://geocompr.robinlovelace.net/location.html">13</a>.</li>
</ul>
<ol start="5" style="list-style-type: decimal">
<li>Imagine that you want to extend the scenario by creating key <em>areas</em> (not routes) for investment in place-based cycling policies such as car-free zones, cycle parking points and reduced car parking strategy. How could raster data assist with this work?</li>
</ol>
<p>Raster data analysis could help by providing useful aggregates of cycling potential (as estimated using previous methods) at a constant level of geographic resolution. The raster cells with the highest estimated potential would be prioritised.</p>
<p>Bonus: develop a raster layer that divides the Bristol region into 100 cells (10 by 10) and provide a metric related to transport policy, such as number of people trips that pass through each cell by walking or the average speed limit of roads, from the <code>bristol_ways</code> dataset (the approach taken in this <a href="https://geocompr.robinlovelace.net/location.html#location">Chapter</a>).</p>
<p>This exercise can be tackled in many ways. The code chunk below provides an example of how rasters could focus attention on important ‘hotspots’, by calculating the cells where most people may walk (using an illustrative sample of the top 20 most walked desire lines):</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">bristol_raster100</span> <span class="op">=</span> <span class="kw">raster</span>::<span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span>(<span class="kw">bristol_region</span>, ncols = <span class="fl">100</span>, nrows = <span class="fl">100</span>)
<span class="kw">bristol_walking</span> <span class="op">=</span> <span class="kw">raster</span>::<span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterize.html">rasterize</a></span>(
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/top_n.html">top_n</a></span>(<span class="kw">desire_lines</span>, n = <span class="fl">20</span>, wt = <span class="kw">foot</span>),
  y = <span class="kw">bristol_raster100</span>,
  field = <span class="st">"foot"</span>,
  fun = <span class="kw">sum</span>
  )
<span class="fu"><a href="https://rdrr.io/pkg/sf/man/plot.html">plot</a></span>(<span class="kw">bristol_walking</span>)
</pre></div>
<p><img src="solutions12_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Robin Lovelace, Jakub Nowosad, Jannes Muenchow.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
